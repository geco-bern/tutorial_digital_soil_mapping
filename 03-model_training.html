<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>AGDS 2: Digital Soil Mapping - 3&nbsp; Train a Random Forest</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./04-model_test.html" rel="next">
<link href="./02-data_preparation.html" rel="prev">
<link href="./figures/favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta name="twitter:title" content="AGDS 2: Digital Soil Mapping - 3&nbsp; Train a Random Forest">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="03-model_training_files/figure-html/unnamed-chunk-5-1.png">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="./images/logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title"></span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/geco-bern/tutorial_digital_soil_mapping" rel="" target=""><i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" rel="" target="" aria-current="page">
 <span class="menu-text">Home</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./03-model_training.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Train a Random Forest</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-data_preparation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data preparation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-model_training.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Train a Random Forest</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-model_test.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Model Analysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./99-exercise.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Report Exercise</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./99-variables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Variables</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#load-data" id="toc-load-data" class="nav-link active" data-scroll-target="#load-data"><span class="header-section-number">3.1</span> Load data</a></li>
  <li><a href="#preparations" id="toc-preparations" class="nav-link" data-scroll-target="#preparations"><span class="header-section-number">3.2</span> Preparations</a></li>
  <li><a href="#model-training" id="toc-model-training" class="nav-link" data-scroll-target="#model-training"><span class="header-section-number">3.3</span> Model training</a></li>
  <li><a href="#variable-importance" id="toc-variable-importance" class="nav-link" data-scroll-target="#variable-importance"><span class="header-section-number">3.4</span> Variable importance</a></li>
  <li><a href="#variable-selection" id="toc-variable-selection" class="nav-link" data-scroll-target="#variable-selection"><span class="header-section-number">3.5</span> Variable selection</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-modelfit" class="quarto-section-identifier"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Train a Random Forest</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>In this chapter, we are going to use the data prepared in <a href="02-data_preparation.html"><span>Chapter&nbsp;2</span></a>, train a Random Forest model, and evaluate the variable importance of the different predictors_all used in the model. To recap the basics of the Random Forest algorithm and its implementation and use in R, head over to <a href="https://geco-bern.github.io/agds/randomforest.html">Chapter 11 of AGDS book</a>.</p>
<section id="load-data" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="load-data"><span class="header-section-number">3.1</span> Load data</h2>
<p>In the previous Chapter, we created a dataframe that holds information on the soil sampling locations and the covariates that we extracted for these positions. Let’s load this datafarme into our environment</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>df_full <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data/df_full.rds"</span>))</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_full) <span class="sc">|&gt;</span> </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 1%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 0%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 1%">
<col style="width: 0%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 0%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 1%">
<col style="width: 0%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 0%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 0%">
<col style="width: 1%">
<col style="width: 0%">
<col style="width: 1%">
<col style="width: 0%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 0%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 1%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 1%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">site_id_unique</th>
<th style="text-align: left;">timeset</th>
<th style="text-align: right;">x</th>
<th style="text-align: right;">y</th>
<th style="text-align: left;">dataset</th>
<th style="text-align: left;">dclass</th>
<th style="text-align: right;">waterlog.30</th>
<th style="text-align: right;">waterlog.50</th>
<th style="text-align: right;">waterlog.100</th>
<th style="text-align: right;">ph.0.10</th>
<th style="text-align: right;">ph.10.30</th>
<th style="text-align: right;">ph.30.50</th>
<th style="text-align: right;">ph.50.100</th>
<th style="text-align: right;">NegO</th>
<th style="text-align: right;">PosO</th>
<th style="text-align: right;">Se_MRRTF2m</th>
<th style="text-align: right;">Se_MRVBF2m</th>
<th style="text-align: right;">Se_NO2m_r500</th>
<th style="text-align: right;">Se_PO2m_r500</th>
<th style="text-align: right;">Se_SAR2m</th>
<th style="text-align: right;">Se_SCA2m</th>
<th style="text-align: right;">Se_TWI2m</th>
<th style="text-align: right;">Se_TWI2m_s15</th>
<th style="text-align: right;">Se_TWI2m_s60</th>
<th style="text-align: right;">Se_alti2m_std_50c</th>
<th style="text-align: right;">Se_conv2m</th>
<th style="text-align: right;">Se_curv25m</th>
<th style="text-align: right;">Se_curv2m</th>
<th style="text-align: right;">Se_curv2m_fmean_50c</th>
<th style="text-align: right;">Se_curv2m_fmean_5c</th>
<th style="text-align: right;">Se_curv2m_s60</th>
<th style="text-align: right;">Se_curv2m_std_50c</th>
<th style="text-align: right;">Se_curv2m_std_5c</th>
<th style="text-align: right;">Se_curv50m</th>
<th style="text-align: right;">Se_curv6m</th>
<th style="text-align: right;">Se_curvplan25m</th>
<th style="text-align: right;">Se_curvplan2m</th>
<th style="text-align: right;">Se_curvplan2m_fmean_50c</th>
<th style="text-align: right;">Se_curvplan2m_fmean_5c</th>
<th style="text-align: right;">Se_curvplan2m_s60</th>
<th style="text-align: right;">Se_curvplan2m_s7</th>
<th style="text-align: right;">Se_curvplan2m_std_50c</th>
<th style="text-align: right;">Se_curvplan2m_std_5c</th>
<th style="text-align: right;">Se_curvplan50m</th>
<th style="text-align: right;">Se_curvprof25m</th>
<th style="text-align: right;">Se_curvprof2m</th>
<th style="text-align: right;">Se_curvprof2m_fmean_50c</th>
<th style="text-align: right;">Se_curvprof2m_fmean_5c</th>
<th style="text-align: right;">Se_curvprof2m_s60</th>
<th style="text-align: right;">Se_curvprof2m_s7</th>
<th style="text-align: right;">Se_curvprof2m_std_50c</th>
<th style="text-align: right;">Se_curvprof2m_std_5c</th>
<th style="text-align: right;">Se_curvprof50m</th>
<th style="text-align: right;">Se_diss2m_50c</th>
<th style="text-align: right;">Se_diss2m_5c</th>
<th style="text-align: right;">Se_e_aspect25m</th>
<th style="text-align: right;">Se_e_aspect2m</th>
<th style="text-align: right;">Se_e_aspect2m_5c</th>
<th style="text-align: right;">Se_e_aspect50m</th>
<th style="text-align: right;">Se_n_aspect2m</th>
<th style="text-align: right;">Se_n_aspect2m_50c</th>
<th style="text-align: right;">Se_n_aspect2m_5c</th>
<th style="text-align: right;">Se_n_aspect50m</th>
<th style="text-align: right;">Se_n_aspect6m</th>
<th style="text-align: right;">Se_rough2m_10c</th>
<th style="text-align: right;">Se_rough2m_5c</th>
<th style="text-align: right;">Se_rough2m_rect3c</th>
<th style="text-align: right;">Se_slope2m</th>
<th style="text-align: right;">Se_slope2m_fmean_50c</th>
<th style="text-align: right;">Se_slope2m_fmean_5c</th>
<th style="text-align: right;">Se_slope2m_s60</th>
<th style="text-align: right;">Se_slope2m_s7</th>
<th style="text-align: right;">Se_slope2m_std_50c</th>
<th style="text-align: right;">Se_slope2m_std_5c</th>
<th style="text-align: right;">Se_slope50m</th>
<th style="text-align: right;">Se_slope6m</th>
<th style="text-align: right;">Se_toposcale2m_r3_r50_i10s</th>
<th style="text-align: right;">Se_tpi_2m_50c</th>
<th style="text-align: right;">Se_tpi_2m_5c</th>
<th style="text-align: right;">Se_tri2m_altern_3c</th>
<th style="text-align: right;">Se_tsc10_2m</th>
<th style="text-align: right;">Se_vrm2m</th>
<th style="text-align: right;">Se_vrm2m_r10c</th>
<th style="text-align: right;">be_gwn25_hdist</th>
<th style="text-align: right;">be_gwn25_vdist</th>
<th style="text-align: right;">cindx10_25</th>
<th style="text-align: right;">cindx50_25</th>
<th style="text-align: left;">geo500h1id</th>
<th style="text-align: left;">geo500h3id</th>
<th style="text-align: left;">lgm</th>
<th style="text-align: right;">lsf</th>
<th style="text-align: right;">mrrtf25</th>
<th style="text-align: right;">mrvbf25</th>
<th style="text-align: right;">mt_gh_y</th>
<th style="text-align: right;">mt_rr_y</th>
<th style="text-align: right;">mt_td_y</th>
<th style="text-align: right;">mt_tt_y</th>
<th style="text-align: right;">mt_ttvar</th>
<th style="text-align: right;">protindx</th>
<th style="text-align: right;">terrTextur</th>
<th style="text-align: right;">tsc25_18</th>
<th style="text-align: right;">tsc25_40</th>
<th style="text-align: right;">vdcn25</th>
<th style="text-align: left;">vszone</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">4_26-In-005</td>
<td style="text-align: left;">d1968_1974_ptf</td>
<td style="text-align: right;">2571994</td>
<td style="text-align: right;">1203001</td>
<td style="text-align: left;">validation</td>
<td style="text-align: left;">poor</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6.071733</td>
<td style="text-align: right;">6.227780</td>
<td style="text-align: right;">7.109235</td>
<td style="text-align: right;">7.214589</td>
<td style="text-align: right;">1.569110</td>
<td style="text-align: right;">1.534734</td>
<td style="text-align: right;">5.930607</td>
<td style="text-align: right;">6.950892</td>
<td style="text-align: right;">1.562085</td>
<td style="text-align: right;">1.548762</td>
<td style="text-align: right;">4.000910</td>
<td style="text-align: right;">16.248077</td>
<td style="text-align: right;">0.0011592</td>
<td style="text-align: right;">0.0032796</td>
<td style="text-align: right;">0.0049392</td>
<td style="text-align: right;">0.3480562</td>
<td style="text-align: right;">-40.5395088</td>
<td style="text-align: right;">-0.0014441</td>
<td style="text-align: right;">-1.9364884</td>
<td style="text-align: right;">-0.0062570</td>
<td style="text-align: right;">0.0175912</td>
<td style="text-align: right;">0.0002296</td>
<td style="text-align: right;">2.9204133</td>
<td style="text-align: right;">1.1769447</td>
<td style="text-align: right;">0.0031319</td>
<td style="text-align: right;">-0.5886537</td>
<td style="text-align: right;">-0.0042508</td>
<td style="text-align: right;">-1.0857303</td>
<td style="text-align: right;">-0.0445323</td>
<td style="text-align: right;">-0.0481024</td>
<td style="text-align: right;">-0.0504083</td>
<td style="text-align: right;">-0.1655090</td>
<td style="text-align: right;">1.5687343</td>
<td style="text-align: right;">0.6229440</td>
<td style="text-align: right;">0.0007920</td>
<td style="text-align: right;">-0.0028067</td>
<td style="text-align: right;">0.8507581</td>
<td style="text-align: right;">-0.0382753</td>
<td style="text-align: right;">-0.0656936</td>
<td style="text-align: right;">-0.0506380</td>
<td style="text-align: right;">-0.0732220</td>
<td style="text-align: right;">1.6507173</td>
<td style="text-align: right;">0.7082230</td>
<td style="text-align: right;">-0.0023399</td>
<td style="text-align: right;">0.3934371</td>
<td style="text-align: right;">0.1770810</td>
<td style="text-align: right;">-0.9702092</td>
<td style="text-align: right;">-0.5661940</td>
<td style="text-align: right;">-0.7929600</td>
<td style="text-align: right;">-0.9939429</td>
<td style="text-align: right;">-0.2402939</td>
<td style="text-align: right;">-0.2840056</td>
<td style="text-align: right;">-0.6084610</td>
<td style="text-align: right;">-0.0577110</td>
<td style="text-align: right;">-0.7661251</td>
<td style="text-align: right;">0.3228087</td>
<td style="text-align: right;">0.2241062</td>
<td style="text-align: right;">0.2003846</td>
<td style="text-align: right;">1.1250136</td>
<td style="text-align: right;">0.9428899</td>
<td style="text-align: right;">0.6683306</td>
<td style="text-align: right;">0.9333237</td>
<td style="text-align: right;">0.7310556</td>
<td style="text-align: right;">0.8815832</td>
<td style="text-align: right;">0.3113754</td>
<td style="text-align: right;">0.3783818</td>
<td style="text-align: right;">0.5250366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">-0.0940372</td>
<td style="text-align: right;">-0.0583917</td>
<td style="text-align: right;">10.319408</td>
<td style="text-align: right;">0.4645128</td>
<td style="text-align: right;">0.0002450</td>
<td style="text-align: right;">0.000125</td>
<td style="text-align: right;">234.39087</td>
<td style="text-align: right;">1.2986320</td>
<td style="text-align: right;">-10.62191</td>
<td style="text-align: right;">-6.9658718</td>
<td style="text-align: left;">6</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">7</td>
<td style="text-align: right;">0.0770846</td>
<td style="text-align: right;">0.0184651</td>
<td style="text-align: right;">4.977099</td>
<td style="text-align: right;">1316.922</td>
<td style="text-align: right;">9931.120</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">98</td>
<td style="text-align: right;">183</td>
<td style="text-align: right;">0.0159717</td>
<td style="text-align: right;">0.6248673</td>
<td style="text-align: right;">0.3332805</td>
<td style="text-align: right;">1.784737</td>
<td style="text-align: right;">65.62196</td>
<td style="text-align: left;">6</td>
</tr>
<tr class="even">
<td style="text-align: left;">4_26-In-006</td>
<td style="text-align: left;">d1974_1978</td>
<td style="text-align: right;">2572149</td>
<td style="text-align: right;">1202965</td>
<td style="text-align: left;">calibration</td>
<td style="text-align: left;">poor</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6.900000</td>
<td style="text-align: right;">6.947128</td>
<td style="text-align: right;">7.203502</td>
<td style="text-align: right;">7.700000</td>
<td style="text-align: right;">1.568917</td>
<td style="text-align: right;">1.533827</td>
<td style="text-align: right;">5.984921</td>
<td style="text-align: right;">6.984581</td>
<td style="text-align: right;">1.543384</td>
<td style="text-align: right;">1.558683</td>
<td style="text-align: right;">4.001326</td>
<td style="text-align: right;">3.357315</td>
<td style="text-align: right;">0.0139006</td>
<td style="text-align: right;">0.0070509</td>
<td style="text-align: right;">0.0067992</td>
<td style="text-align: right;">0.1484705</td>
<td style="text-align: right;">19.0945148</td>
<td style="text-align: right;">-0.0190294</td>
<td style="text-align: right;">2.1377332</td>
<td style="text-align: right;">0.0021045</td>
<td style="text-align: right;">0.0221433</td>
<td style="text-align: right;">0.0000390</td>
<td style="text-align: right;">3.8783867</td>
<td style="text-align: right;">4.3162045</td>
<td style="text-align: right;">-0.0171786</td>
<td style="text-align: right;">0.1278165</td>
<td style="text-align: right;">-0.0119618</td>
<td style="text-align: right;">-0.3522736</td>
<td style="text-align: right;">-0.0501855</td>
<td style="text-align: right;">-0.3270764</td>
<td style="text-align: right;">-0.1004921</td>
<td style="text-align: right;">-0.5133076</td>
<td style="text-align: right;">2.0736780</td>
<td style="text-align: right;">2.2502327</td>
<td style="text-align: right;">-0.0073879</td>
<td style="text-align: right;">0.0070676</td>
<td style="text-align: right;">-2.4900069</td>
<td style="text-align: right;">-0.0522900</td>
<td style="text-align: right;">-0.3492197</td>
<td style="text-align: right;">-0.1005311</td>
<td style="text-align: right;">-0.4981292</td>
<td style="text-align: right;">2.1899190</td>
<td style="text-align: right;">2.4300070</td>
<td style="text-align: right;">0.0097907</td>
<td style="text-align: right;">0.4014700</td>
<td style="text-align: right;">0.7360508</td>
<td style="text-align: right;">0.5683194</td>
<td style="text-align: right;">-0.3505180</td>
<td style="text-align: right;">0.8753148</td>
<td style="text-align: right;">0.3406741</td>
<td style="text-align: right;">0.4917848</td>
<td style="text-align: right;">-0.5732749</td>
<td style="text-align: right;">0.4801802</td>
<td style="text-align: right;">-0.4550385</td>
<td style="text-align: right;">0.7722272</td>
<td style="text-align: right;">0.2730940</td>
<td style="text-align: right;">0.2489859</td>
<td style="text-align: right;">0.2376962</td>
<td style="text-align: right;">1.3587183</td>
<td style="text-align: right;">1.0895698</td>
<td style="text-align: right;">0.9857153</td>
<td style="text-align: right;">1.0231543</td>
<td style="text-align: right;">1.0398037</td>
<td style="text-align: right;">1.0152543</td>
<td style="text-align: right;">0.5357812</td>
<td style="text-align: right;">0.0645478</td>
<td style="text-align: right;">0.5793087</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">-0.0014692</td>
<td style="text-align: right;">0.0180000</td>
<td style="text-align: right;">12.603136</td>
<td style="text-align: right;">0.5536283</td>
<td style="text-align: right;">0.0005389</td>
<td style="text-align: right;">0.000300</td>
<td style="text-align: right;">127.41681</td>
<td style="text-align: right;">1.7064546</td>
<td style="text-align: right;">-10.87862</td>
<td style="text-align: right;">-11.8201790</td>
<td style="text-align: left;">6</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">7</td>
<td style="text-align: right;">0.0860347</td>
<td style="text-align: right;">0.0544361</td>
<td style="text-align: right;">4.975796</td>
<td style="text-align: right;">1317.000</td>
<td style="text-align: right;">9931.672</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">98</td>
<td style="text-align: right;">183</td>
<td style="text-align: right;">0.0204794</td>
<td style="text-align: right;">0.7573612</td>
<td style="text-align: right;">0.3395441</td>
<td style="text-align: right;">1.832904</td>
<td style="text-align: right;">69.16074</td>
<td style="text-align: left;">6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">4_26-In-012</td>
<td style="text-align: left;">d1974_1978</td>
<td style="text-align: right;">2572937</td>
<td style="text-align: right;">1203693</td>
<td style="text-align: left;">calibration</td>
<td style="text-align: left;">moderate</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6.200000</td>
<td style="text-align: right;">6.147128</td>
<td style="text-align: right;">5.603502</td>
<td style="text-align: right;">5.904355</td>
<td style="text-align: right;">1.569093</td>
<td style="text-align: right;">1.543057</td>
<td style="text-align: right;">5.953919</td>
<td style="text-align: right;">6.990917</td>
<td style="text-align: right;">1.565405</td>
<td style="text-align: right;">1.563151</td>
<td style="text-align: right;">4.000320</td>
<td style="text-align: right;">11.330072</td>
<td style="text-align: right;">0.0011398</td>
<td style="text-align: right;">0.0021498</td>
<td style="text-align: right;">0.0017847</td>
<td style="text-align: right;">0.1112066</td>
<td style="text-align: right;">-9.1396294</td>
<td style="text-align: right;">0.0039732</td>
<td style="text-align: right;">-0.4178924</td>
<td style="text-align: right;">0.0009509</td>
<td style="text-align: right;">0.0431735</td>
<td style="text-align: right;">0.0034232</td>
<td style="text-align: right;">0.7022317</td>
<td style="text-align: right;">0.4170935</td>
<td style="text-align: right;">-0.0026431</td>
<td style="text-align: right;">-0.0183221</td>
<td style="text-align: right;">0.0015183</td>
<td style="text-align: right;">-0.2168447</td>
<td style="text-align: right;">-0.0079620</td>
<td style="text-align: right;">0.0053904</td>
<td style="text-align: right;">-0.0091239</td>
<td style="text-align: right;">-0.0110896</td>
<td style="text-align: right;">0.3974485</td>
<td style="text-align: right;">0.2292406</td>
<td style="text-align: right;">-0.0013561</td>
<td style="text-align: right;">-0.0024548</td>
<td style="text-align: right;">0.2010477</td>
<td style="text-align: right;">-0.0089129</td>
<td style="text-align: right;">-0.0377831</td>
<td style="text-align: right;">-0.0125471</td>
<td style="text-align: right;">-0.0052359</td>
<td style="text-align: right;">0.4158890</td>
<td style="text-align: right;">0.2700820</td>
<td style="text-align: right;">0.0012870</td>
<td style="text-align: right;">0.6717541</td>
<td style="text-align: right;">0.4404107</td>
<td style="text-align: right;">-0.6987815</td>
<td style="text-align: right;">-0.1960597</td>
<td style="text-align: right;">-0.3866692</td>
<td style="text-align: right;">-0.7592779</td>
<td style="text-align: right;">-0.9633239</td>
<td style="text-align: right;">-0.3006475</td>
<td style="text-align: right;">-0.9221049</td>
<td style="text-align: right;">-0.3257418</td>
<td style="text-align: right;">-0.9502072</td>
<td style="text-align: right;">0.2305476</td>
<td style="text-align: right;">0.2182523</td>
<td style="text-align: right;">0.1434273</td>
<td style="text-align: right;">0.7160403</td>
<td style="text-align: right;">0.5758902</td>
<td style="text-align: right;">0.5300468</td>
<td style="text-align: right;">0.5107915</td>
<td style="text-align: right;">0.5744110</td>
<td style="text-align: right;">0.4975456</td>
<td style="text-align: right;">0.2001768</td>
<td style="text-align: right;">0.1311051</td>
<td style="text-align: right;">0.4620202</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0340407</td>
<td style="text-align: right;">-0.0145804</td>
<td style="text-align: right;">7.100000</td>
<td style="text-align: right;">0.4850160</td>
<td style="text-align: right;">0.0000124</td>
<td style="text-align: right;">0.000000</td>
<td style="text-align: right;">143.41533</td>
<td style="text-align: right;">0.9372618</td>
<td style="text-align: right;">22.10210</td>
<td style="text-align: right;">0.2093917</td>
<td style="text-align: left;">6</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">7</td>
<td style="text-align: right;">0.0737963</td>
<td style="text-align: right;">3.6830916</td>
<td style="text-align: right;">4.986864</td>
<td style="text-align: right;">1315.134</td>
<td style="text-align: right;">9935.438</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">98</td>
<td style="text-align: right;">183</td>
<td style="text-align: right;">0.0048880</td>
<td style="text-align: right;">0.7978453</td>
<td style="text-align: right;">0.4455501</td>
<td style="text-align: right;">1.981526</td>
<td style="text-align: right;">63.57096</td>
<td style="text-align: left;">6</td>
</tr>
<tr class="even">
<td style="text-align: left;">4_26-In-014</td>
<td style="text-align: left;">d1974_1978</td>
<td style="text-align: right;">2573374</td>
<td style="text-align: right;">1203710</td>
<td style="text-align: left;">validation</td>
<td style="text-align: left;">well</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6.600000</td>
<td style="text-align: right;">6.754607</td>
<td style="text-align: right;">7.200000</td>
<td style="text-align: right;">7.151129</td>
<td style="text-align: right;">1.569213</td>
<td style="text-align: right;">1.542792</td>
<td style="text-align: right;">4.856076</td>
<td style="text-align: right;">6.964162</td>
<td style="text-align: right;">1.562499</td>
<td style="text-align: right;">1.562670</td>
<td style="text-align: right;">4.000438</td>
<td style="text-align: right;">42.167496</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">0.0008454</td>
<td style="text-align: right;">0.0021042</td>
<td style="text-align: right;">0.3710849</td>
<td style="text-align: right;">-0.9318936</td>
<td style="text-align: right;">-0.0371234</td>
<td style="text-align: right;">-0.0289909</td>
<td style="text-align: right;">0.0029348</td>
<td style="text-align: right;">-0.1056513</td>
<td style="text-align: right;">0.0127788</td>
<td style="text-align: right;">1.5150748</td>
<td style="text-align: right;">0.2413423</td>
<td style="text-align: right;">0.0020990</td>
<td style="text-align: right;">-0.0706228</td>
<td style="text-align: right;">-0.0113604</td>
<td style="text-align: right;">-0.0272214</td>
<td style="text-align: right;">-0.0301961</td>
<td style="text-align: right;">-0.0346193</td>
<td style="text-align: right;">-0.0273140</td>
<td style="text-align: right;">-0.0343277</td>
<td style="text-align: right;">0.8245047</td>
<td style="text-align: right;">0.1029889</td>
<td style="text-align: right;">-0.0041158</td>
<td style="text-align: right;">0.0257630</td>
<td style="text-align: right;">0.0017695</td>
<td style="text-align: right;">-0.0331309</td>
<td style="text-align: right;">0.0710320</td>
<td style="text-align: right;">-0.0400928</td>
<td style="text-align: right;">0.0529446</td>
<td style="text-align: right;">0.8635767</td>
<td style="text-align: right;">0.1616543</td>
<td style="text-align: right;">-0.0062147</td>
<td style="text-align: right;">0.4988544</td>
<td style="text-align: right;">0.4217250</td>
<td style="text-align: right;">-0.8485889</td>
<td style="text-align: right;">-0.8836724</td>
<td style="text-align: right;">-0.8657616</td>
<td style="text-align: right;">-0.8993938</td>
<td style="text-align: right;">-0.4677161</td>
<td style="text-align: right;">-0.5735765</td>
<td style="text-align: right;">-0.4998477</td>
<td style="text-align: right;">-0.4121092</td>
<td style="text-align: right;">-0.4782534</td>
<td style="text-align: right;">0.3859352</td>
<td style="text-align: right;">0.2732429</td>
<td style="text-align: right;">0.1554769</td>
<td style="text-align: right;">0.8482135</td>
<td style="text-align: right;">0.8873205</td>
<td style="text-align: right;">0.8635756</td>
<td style="text-align: right;">0.9015982</td>
<td style="text-align: right;">0.8518201</td>
<td style="text-align: right;">0.5767300</td>
<td style="text-align: right;">0.2149791</td>
<td style="text-align: right;">0.3928713</td>
<td style="text-align: right;">0.8432562</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0686932</td>
<td style="text-align: right;">-0.0085602</td>
<td style="text-align: right;">8.303085</td>
<td style="text-align: right;">0.3951114</td>
<td style="text-align: right;">0.0000857</td>
<td style="text-align: right;">0.000100</td>
<td style="text-align: right;">165.80418</td>
<td style="text-align: right;">0.7653937</td>
<td style="text-align: right;">-20.11569</td>
<td style="text-align: right;">-7.7729993</td>
<td style="text-align: left;">6</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">7</td>
<td style="text-align: right;">0.0859686</td>
<td style="text-align: right;">0.0075817</td>
<td style="text-align: right;">5.285522</td>
<td style="text-align: right;">1315.160</td>
<td style="text-align: right;">9939.923</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">98</td>
<td style="text-align: right;">183</td>
<td style="text-align: right;">0.0064054</td>
<td style="text-align: right;">0.4829135</td>
<td style="text-align: right;">0.4483251</td>
<td style="text-align: right;">2.113142</td>
<td style="text-align: right;">64.60535</td>
<td style="text-align: left;">6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">4_26-In-015</td>
<td style="text-align: left;">d1968_1974_ptf</td>
<td style="text-align: right;">2573553</td>
<td style="text-align: right;">1203935</td>
<td style="text-align: left;">validation</td>
<td style="text-align: left;">moderate</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6.272715</td>
<td style="text-align: right;">6.272715</td>
<td style="text-align: right;">6.718392</td>
<td style="text-align: right;">7.269008</td>
<td style="text-align: right;">1.570359</td>
<td style="text-align: right;">1.541979</td>
<td style="text-align: right;">4.130917</td>
<td style="text-align: right;">6.945287</td>
<td style="text-align: right;">1.550528</td>
<td style="text-align: right;">1.562685</td>
<td style="text-align: right;">4.000948</td>
<td style="text-align: right;">5.479310</td>
<td style="text-align: right;">0.0054557</td>
<td style="text-align: right;">0.0043268</td>
<td style="text-align: right;">0.0045225</td>
<td style="text-align: right;">0.3907509</td>
<td style="text-align: right;">4.2692256</td>
<td style="text-align: right;">0.0378648</td>
<td style="text-align: right;">0.6409346</td>
<td style="text-align: right;">0.0022611</td>
<td style="text-align: right;">-0.1020419</td>
<td style="text-align: right;">0.0161510</td>
<td style="text-align: right;">3.6032522</td>
<td style="text-align: right;">1.8169731</td>
<td style="text-align: right;">0.0346340</td>
<td style="text-align: right;">0.0476020</td>
<td style="text-align: right;">0.0378154</td>
<td style="text-align: right;">0.2968794</td>
<td style="text-align: right;">-0.0179657</td>
<td style="text-align: right;">-0.0137853</td>
<td style="text-align: right;">-0.0146946</td>
<td style="text-align: right;">0.0060875</td>
<td style="text-align: right;">1.4667766</td>
<td style="text-align: right;">0.9816071</td>
<td style="text-align: right;">0.0337645</td>
<td style="text-align: right;">-0.0000494</td>
<td style="text-align: right;">-0.3440553</td>
<td style="text-align: right;">-0.0202268</td>
<td style="text-align: right;">0.0882566</td>
<td style="text-align: right;">-0.0308456</td>
<td style="text-align: right;">0.0929077</td>
<td style="text-align: right;">2.6904552</td>
<td style="text-align: right;">1.0218329</td>
<td style="text-align: right;">-0.0008695</td>
<td style="text-align: right;">0.6999696</td>
<td style="text-align: right;">0.3944107</td>
<td style="text-align: right;">-0.8918364</td>
<td style="text-align: right;">-0.7795515</td>
<td style="text-align: right;">-0.8864348</td>
<td style="text-align: right;">-0.4249992</td>
<td style="text-align: right;">0.5919228</td>
<td style="text-align: right;">0.4304937</td>
<td style="text-align: right;">0.4614536</td>
<td style="text-align: right;">0.6559467</td>
<td style="text-align: right;">0.4574654</td>
<td style="text-align: right;">0.4330348</td>
<td style="text-align: right;">0.3299487</td>
<td style="text-align: right;">0.1889674</td>
<td style="text-align: right;">1.2301254</td>
<td style="text-align: right;">1.8937486</td>
<td style="text-align: right;">1.2098556</td>
<td style="text-align: right;">1.5986075</td>
<td style="text-align: right;">1.2745584</td>
<td style="text-align: right;">2.7759163</td>
<td style="text-align: right;">0.5375320</td>
<td style="text-align: right;">0.3582314</td>
<td style="text-align: right;">1.1426100</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.3005829</td>
<td style="text-align: right;">0.0061576</td>
<td style="text-align: right;">10.110727</td>
<td style="text-align: right;">0.5134069</td>
<td style="text-align: right;">0.0002062</td>
<td style="text-align: right;">0.000200</td>
<td style="text-align: right;">61.39244</td>
<td style="text-align: right;">1.0676192</td>
<td style="text-align: right;">-55.12566</td>
<td style="text-align: right;">-14.0670462</td>
<td style="text-align: left;">6</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">7</td>
<td style="text-align: right;">0.0650000</td>
<td style="text-align: right;">0.0007469</td>
<td style="text-align: right;">5.894688</td>
<td style="text-align: right;">1315.056</td>
<td style="text-align: right;">9942.032</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">98</td>
<td style="text-align: right;">183</td>
<td style="text-align: right;">0.0042235</td>
<td style="text-align: right;">0.6290755</td>
<td style="text-align: right;">0.3974232</td>
<td style="text-align: right;">2.080674</td>
<td style="text-align: right;">61.16533</td>
<td style="text-align: left;">6</td>
</tr>
<tr class="even">
<td style="text-align: left;">4_26-In-016</td>
<td style="text-align: left;">d1968_1974_ptf</td>
<td style="text-align: right;">2573310</td>
<td style="text-align: right;">1204328</td>
<td style="text-align: left;">calibration</td>
<td style="text-align: left;">poor</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6.272715</td>
<td style="text-align: right;">6.160700</td>
<td style="text-align: right;">5.559031</td>
<td style="text-align: right;">5.161655</td>
<td style="text-align: right;">1.569434</td>
<td style="text-align: right;">1.541606</td>
<td style="text-align: right;">2.030315</td>
<td style="text-align: right;">6.990967</td>
<td style="text-align: right;">1.563066</td>
<td style="text-align: right;">1.552568</td>
<td style="text-align: right;">4.000725</td>
<td style="text-align: right;">13.499996</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">0.0001476</td>
<td style="text-align: right;">0.0003817</td>
<td style="text-align: right;">0.1931891</td>
<td style="text-align: right;">-0.1732794</td>
<td style="text-align: right;">-0.1602274</td>
<td style="text-align: right;">0.0318570</td>
<td style="text-align: right;">-0.0035833</td>
<td style="text-align: right;">-0.1282881</td>
<td style="text-align: right;">0.0003549</td>
<td style="text-align: right;">1.5897882</td>
<td style="text-align: right;">0.8171870</td>
<td style="text-align: right;">-0.0123340</td>
<td style="text-align: right;">0.0400775</td>
<td style="text-align: right;">-0.0813964</td>
<td style="text-align: right;">0.0100844</td>
<td style="text-align: right;">-0.0049875</td>
<td style="text-align: right;">0.0320331</td>
<td style="text-align: right;">-0.0049053</td>
<td style="text-align: right;">0.0374298</td>
<td style="text-align: right;">0.7912259</td>
<td style="text-align: right;">0.3455668</td>
<td style="text-align: right;">-0.0059622</td>
<td style="text-align: right;">0.0788309</td>
<td style="text-align: right;">-0.0217726</td>
<td style="text-align: right;">-0.0014042</td>
<td style="text-align: right;">0.1603212</td>
<td style="text-align: right;">-0.0052602</td>
<td style="text-align: right;">0.0867119</td>
<td style="text-align: right;">1.0207798</td>
<td style="text-align: right;">0.6147888</td>
<td style="text-align: right;">0.0063718</td>
<td style="text-align: right;">0.3157751</td>
<td style="text-align: right;">0.5292308</td>
<td style="text-align: right;">-0.8766075</td>
<td style="text-align: right;">0.8129975</td>
<td style="text-align: right;">0.5905659</td>
<td style="text-align: right;">0.1640853</td>
<td style="text-align: right;">0.5820994</td>
<td style="text-align: right;">0.6325440</td>
<td style="text-align: right;">0.8054439</td>
<td style="text-align: right;">0.7448481</td>
<td style="text-align: right;">0.6081498</td>
<td style="text-align: right;">0.3688371</td>
<td style="text-align: right;">0.2607146</td>
<td style="text-align: right;">0.1763995</td>
<td style="text-align: right;">1.0906221</td>
<td style="text-align: right;">1.0418727</td>
<td style="text-align: right;">0.8515157</td>
<td style="text-align: right;">1.2106605</td>
<td style="text-align: right;">0.8916541</td>
<td style="text-align: right;">1.2163279</td>
<td style="text-align: right;">0.4894866</td>
<td style="text-align: right;">0.2049688</td>
<td style="text-align: right;">0.7156029</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">-0.0910767</td>
<td style="text-align: right;">0.0034276</td>
<td style="text-align: right;">9.574804</td>
<td style="text-align: right;">0.3864355</td>
<td style="text-align: right;">0.0001151</td>
<td style="text-align: right;">0.000525</td>
<td style="text-align: right;">310.05014</td>
<td style="text-align: right;">0.1321367</td>
<td style="text-align: right;">-17.16055</td>
<td style="text-align: right;">-28.0693741</td>
<td style="text-align: left;">6</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">7</td>
<td style="text-align: right;">0.0731646</td>
<td style="text-align: right;">0.0128017</td>
<td style="text-align: right;">5.938320</td>
<td style="text-align: right;">1315.000</td>
<td style="text-align: right;">9940.597</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">98</td>
<td style="text-align: right;">183</td>
<td style="text-align: right;">0.0040683</td>
<td style="text-align: right;">0.6997021</td>
<td style="text-align: right;">0.4278295</td>
<td style="text-align: right;">2.041467</td>
<td style="text-align: right;">55.78354</td>
<td style="text-align: left;">6</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="preparations" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="preparations"><span class="header-section-number">3.2</span> Preparations</h2>
<p>Before we can fit the model, we have to specify a few settings. First, we have to specify our target and predictor variables. Then, we have to split our dataset into a training and a testing set. Random Forest models cannot deal with <code>NA</code> values, so we have to remove these from our training set.</p>
<p>In the dataset we work with here, the data splitting into training and testing sets is defined by the column <code>dataset</code>. Usually, this is not the case and we split the data ourselves. Have a look at the <a href="https://geco-bern.github.io/agds/supervisedmli.html#data-splitting">section in AGDS Book on data splitting</a>.</p>
<p>As predictors_all we use all the variables for which we have data with spatial coverage - the basis for spatial upscaling. We extracted these data in <a href="02-data_preparation.html"><span>Chapter&nbsp;2</span></a> from geospatial files and the data frame was constructed by <code>cbind()</code>, where columns number 14-104 contain the covariates data, extracted from the geospatial files. See <a href="99-variables.html"><span>Chapter&nbsp;6</span></a> for a description of the variables. We use all of them here as predictors_all for the model.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify target: The pH in the top 10cm</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>target <span class="ot">&lt;-</span> <span class="st">"ph.0.10"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify predictors_all: Remove soil sampling and observational data</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>predictors_all <span class="ot">&lt;-</span> <span class="fu">names</span>(df_full)[<span class="dv">14</span><span class="sc">:</span><span class="fu">ncol</span>(df_full)]</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"The target is:"</span>, target,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"</span><span class="sc">\n</span><span class="st">The predictors_all are:"</span>, <span class="fu">paste0</span>(predictors_all[<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>], <span class="at">sep =</span> <span class="st">", "</span>), <span class="st">"..."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>The target is: ph.0.10 
The predictors_all are: NegO,  PosO,  Se_MRRTF2m,  Se_MRVBF2m,  Se_NO2m_r500,  Se_PO2m_r500,  Se_SAR2m,  Se_SCA2m,  ...</code></pre>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Split dataset into training and testing sets</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>df_train <span class="ot">&lt;-</span> df_full <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(dataset <span class="sc">==</span> <span class="st">"calibration"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>df_test  <span class="ot">&lt;-</span> df_full <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(dataset <span class="sc">==</span> <span class="st">"validation"</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter out any NA to avoid error when running a Random Forest</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>df_train <span class="ot">&lt;-</span> df_train <span class="sc">|&gt;</span> tidyr<span class="sc">::</span><span class="fu">drop_na</span>()</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>df_test <span class="ot">&lt;-</span> df_test   <span class="sc">|&gt;</span> tidyr<span class="sc">::</span><span class="fu">drop_na</span>()</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co"># A little bit of verbose output:</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>n_tot <span class="ot">&lt;-</span> <span class="fu">nrow</span>(df_train) <span class="sc">+</span> <span class="fu">nrow</span>(df_test)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>perc_cal <span class="ot">&lt;-</span> (<span class="fu">nrow</span>(df_train) <span class="sc">/</span> n_tot) <span class="sc">|&gt;</span> <span class="fu">round</span>(<span class="dv">2</span>) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>perc_val <span class="ot">&lt;-</span> (<span class="fu">nrow</span>(df_test)  <span class="sc">/</span> n_tot) <span class="sc">|&gt;</span> <span class="fu">round</span>(<span class="dv">2</span>) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"For model training, we have a calibration / validation split of: "</span>,</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    perc_cal, <span class="st">"/"</span>, perc_val, <span class="st">"%"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>For model training, we have a calibration / validation split of:  75 / 25 %</code></pre>
</div>
</div>
<p>Alright, this looks all good. We have our target and predictor variables saved for easy access later on and the 75/25% split of calibration and validation data looks good, too. We can now move on to model fitting.</p>
</section>
<section id="model-training" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="model-training"><span class="header-section-number">3.3</span> Model training</h2>
<p>The modelling task is to predict the soil pH in the top 10 cm. Let’s start using the default hyperparameters used by <code>ranger::ranger()</code>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Have a look at the values of the defaults by entering. <code>?ranger::ranger</code> in your console and study the function documentation.</p>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ranger() crashes when using tibbles, so we are using the</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># base R notation to enter the data</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>rf_basic <span class="ot">&lt;-</span> ranger<span class="sc">::</span><span class="fu">ranger</span>( </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> df_train[, target],     <span class="co"># target variable</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> df_train[, predictors_all], <span class="co"># Predictor variables</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,                    <span class="co"># Specify the seed for randomization to reproduce the same model again</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">num.threads =</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>() <span class="sc">-</span> <span class="dv">1</span>) <span class="co"># Use all but one CPU core for quick model training</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Print a summary of fitted model</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rf_basic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Ranger result

Call:
 ranger::ranger(y = df_train[, target], x = df_train[, predictors_all],      seed = 42, num.threads = parallel::detectCores() - 1) 

Type:                             Regression 
Number of trees:                  500 
Sample size:                      605 
Number of independent variables:  91 
Mtry:                             9 
Target node size:                 5 
Variable importance mode:         none 
Splitrule:                        variance 
OOB prediction error (MSE):       0.321395 
R squared (OOB):                  0.4560032 </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Predicting categories with Random Forests
</div>
</div>
<div class="callout-body-container callout-body">
<p>If our target variable was a categorical and not a continuous variable, we would have to set the argument <code>probability = TRUE</code>. The output would then be a probability map from 0-100%.</p>
</div>
</div>
<p>Although we only used the pre-defined parameters, we already get a fairly good out-of-bag (OOB) <span class="math inline">\(R^2\)</span> of 0.45 and a MSE of 0.32 pH units. See <a href="https://geco-bern.github.io/agds/randomforest.html#out-of-bag-prediction">here</a> for more background on OOB error estimation with Random Forests.</p>
<p>This is the step at which you may want to reduce the number of predictors_all to avoid collinearity and the risk of overfitting. You may also want to optimize the hyperparameters for improving the model performance and generalisability. Different hyperparameter specifications of the Random Forest model that control the model complexity may be compared. A simple way to do that is to use the {caret} R package which provides machine learning wrapper functions for hyperparameter tuning (among many more functionalities). Its use in combination with Random Forest is demonstrated in <a href="https://geco-bern.github.io/agds/randomforest.html">Chapter 11 of AGDS book</a>. Reducing the number of predictors_all and retaining only the most important ones is important for obtaining robust model generalisability and is approached by what is shown below.</p>
</section>
<section id="variable-importance" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="variable-importance"><span class="header-section-number">3.4</span> Variable importance</h2>
<p>Our model has 91 variables, but we don’t know anything about their role in influencing the model predictions and how important they are for achieving good predictions. <code>ranger::ranger()</code> provides a built-in functionality for quantifying variable importance based on the OOB-error. This functionality can be controlled with the argument <code>importance</code>. When set to <code>'permutation'</code>, the algorithm randomly permutes values of each variable, one at a time, and measures the importance as the resulting decrease in the OOB prediction skill of each decision tree within the Random Forest and returns the average across importances of all decision trees. Note that this is a model-specific variable importance quantification method. In <a href="https://geco-bern.github.io/agds/interpretableml.html#variable-importance">AGDS Book Chapter 12</a>, you have learned about a model model-agnostic method.</p>
<p>The model object returned by the <code>ranger()</code> function stores the variable importance information. The code below accesses this information and sorts the predictor variables with decreasing importance. If the code runs slow, you can also use the faster <code>impurity</code> method (see more information <a href="https://bmcbioinformatics.biomedcentral.com/counter/pdf/10.1186/s12859-016-0995-8.pdf">here</a>).</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's run the basic model again but with recording the variable importance</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>rf_basic <span class="ot">&lt;-</span> ranger<span class="sc">::</span><span class="fu">ranger</span>( </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> df_train[, target],     <span class="co"># target variable</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> df_train[, predictors_all],   <span class="co"># Predictor variables</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">importance   =</span> <span class="st">"permutation"</span>, <span class="co"># Pick permutation to calculate variable importance</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,                    <span class="co"># Specify seed for randomization to reproduce the same model again</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">num.threads =</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>() <span class="sc">-</span> <span class="dv">1</span>) <span class="co"># Use all but one CPU core for quick model training</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the variable importance and create a long tibble</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>vi_rf_basic <span class="ot">&lt;-</span> rf_basic<span class="sc">$</span>variable.importance <span class="sc">|&gt;</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>() <span class="sc">|&gt;</span> </span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"variable"</span>)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot variable importance, ordered by decreasing value</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>gg <span class="ot">&lt;-</span> vi_rf_basic <span class="sc">|&gt;</span> </span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(variable, value), <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"grey50"</span>, <span class="at">width =</span> <span class="fl">0.75</span>) <span class="sc">+</span> </span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Change in OOB MSE after permutation"</span>, </span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">""</span>,</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Variable importance based on OOB"</span>) <span class="sc">+</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">coord_flip</span>()</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>gg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="03-model_training_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>What do we see here? The higher the value, the stronger the effect of permutation on the model performance, the more important the variable. The five most important variables are the following:</p>
<table class="table">
<colgroup>
<col style="width: 18%">
<col style="width: 21%">
<col style="width: 60%">
</colgroup>
<thead>
<tr class="header">
<th>Importance rank</th>
<th>Variable name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>mt_rr_y</td>
<td>Mean annual precipitation</td>
</tr>
<tr class="even">
<td>2</td>
<td>mt_tt_y</td>
<td>Mean annual temperature</td>
</tr>
<tr class="odd">
<td>3</td>
<td>mt_td_y</td>
<td>Mean annual dew point temperature</td>
</tr>
<tr class="even">
<td>4</td>
<td>mt_gh_y</td>
<td>Mean annual incoming radiation</td>
</tr>
<tr class="odd">
<td>5</td>
<td>be_gwn25_vdist</td>
<td>Horizontal distance to water body at 25m resolution</td>
</tr>
</tbody>
</table>
<p>We find that the mean annual precipitation is by far the most important variable in determining soil pH in our model. From a soil-forming perspective, this seems plausible <span class="citation" data-cites="dawson77">(<a href="references.html#ref-dawson77" role="doc-biblioref">Dawson, 1977</a>)</span>. We further find that the four most important variables all describe climate - reflecting its important role as a soil-forming factor. Most of the remaining variables are metrics of the topography. It should also be noted that many of them may be correlated since. Some of them measure the same aspect of topography, but derived from a digital elevation model given at different spatial resolution (see <a href="99-variables.html"><span>Chapter&nbsp;6</span></a>). Due to their potential correlation, dropping one of the affected variables from the model may thus not lead to a strong deterioration of the model skill as its (correlated) information is still contained in the remaining variables.</p>
</section>
<section id="variable-selection" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="variable-selection"><span class="header-section-number">3.5</span> Variable selection</h2>
<p>The large number of variables in our model and the tendency that many of them exhibit a low importance in comparison to the dominating few, and that they may be correlated calls for a <em>variable selection</em>. Reducing the number of predictors_all reduces the risk that remaining predictors_all are correlated. Having correlated predictors_all is a problem - as shown in the context of spatial upscaling by <span class="citation" data-cites="ludwig23">(<a href="references.html#ref-ludwig23" role="doc-biblioref">Ludwig et al., 2023</a>)</span>. Intuitively, this makes sense in view of the fact that if <span class="math inline">\(x_i\)</span> and <span class="math inline">\(x_j\)</span> are correlated, then, for example, <span class="math inline">\(x_i\)</span> is used for modelling its true association with the target variable, while <span class="math inline">\(x_j\)</span> can be “spent” to model randomly occurring covariations with the target - potentially modelling noise in the data. If this happens, overfitting will follow (see <a href="https://geco-bern.github.io/agds/supervisedmli.html#overfitting">here</a>).</p>
<p>Different strategies for reducing the number of predictors_all, while retaining model performance and improving model generalisability, exist. <em>Greedy search</em>, or <em>stepwise regression</em> are often used. Their approach is to sequentially add (stepwise <em>forward</em>) or remove (stepwise <em>backward</em>) predictors_all and to determine the best (complemented or reduced) set of predictors_all in terms of respective model performance at each step. The algorithm stops once the model starts to deteriorate or stops improving. However, it should be noted that these algorithms don’t assess all possible combinations of predictors_all and may thus not find the “globally” optimal model. A stepwise regression was implemented in AGDS I as a Report Exercise (see <a href="https://geco-bern.github.io/agds/regressionclassification.html#report-exercise">here</a>).</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>To dig deeper into understanding how the model works, we could further investigate its partial dependence plots (see <a href="https://geco-bern.github.io/agds/interpretableml.html#partial-dependence-plots">here</a>).</p>
</div>
</div>
<p>An alternative approach to model selection is to consider the variable importance. predictors_all may be selected based on whether removing their association with the target variable (by permuting values of the predictor) deteriorates the model. Additionally, a decision criterion can be introduced for determining whether or not to retain the respective variable. This is implemented by the “Boruta-Algorithm” - an effective and popular approach to variable selection <span class="citation" data-cites="kursa10">(<a href="references.html#ref-kursa10" role="doc-biblioref">Kursa &amp; Rudnicki, 2010</a>)</span>. Boruta is available as an R package {Boruta}, is based on Random Forests, and performs a permutation of variables for determining their importance - as described in <a href="https://geco-bern.github.io/agds/interpretableml.html#variable-importance">Chapter 12 of AGDS Book</a> for model-agnostic variable importance estimation. The algorithm finally categorizes variables into <code>"Rejected"</code>, <code>"Tentative"</code>, and <code>"Confirmed"</code>. Let’s apply Boruta on our data.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># run the algorithm</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>bor <span class="ot">&lt;-</span> Boruta<span class="sc">::</span><span class="fu">Boruta</span>(</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> df_train[, target], </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> df_train[, predictors_all],</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">maxRuns =</span> <span class="dv">50</span>, <span class="co"># Number of iterations. Set to 30 or lower if it takes too long</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">num.threads =</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>()<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co"># obtain results: a data frame with all variables, ordered by their importance</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>df_bor <span class="ot">&lt;-</span> Boruta<span class="sc">::</span><span class="fu">attStats</span>(bor) <span class="sc">|&gt;</span> </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>() <span class="sc">|&gt;</span> </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(dplyr<span class="sc">::</span><span class="fu">desc</span>(meanImp))</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the importance result  </span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(rowname, meanImp), </span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>                             <span class="at">y =</span> meanImp,</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>                             <span class="at">fill =</span> decision), </span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> df_bor) <span class="sc">+</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">width =</span> <span class="fl">0.75</span>) <span class="sc">+</span> </span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"grey30"</span>, <span class="st">"tomato"</span>, <span class="st">"grey70"</span>)) <span class="sc">+</span> </span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Variable importance"</span>, </span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">""</span>,</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Variable importance based on Boruta"</span>) <span class="sc">+</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="03-model_training_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Determine the length <span class="math inline">\(N\)</span> of the vector of predictors_all deemed important by (<code>"Confirmed"</code>) Boruta and compare these “important” variables with the <span class="math inline">\(N\)</span> most important variables of the OOB-based variable importance estimation demonstrated above.</p>
</div>
</div>
<!-- ```{r} -->
<!-- # Check whether the most important variables from Boruta-Algorithm are similar as the -->
<!-- # important variables from the weighted Random Forest model -->
<!-- bor_top10 <- Boruta::attStats(bor) |>  -->
<!--   tibble::rownames_to_column() |>  -->
<!--   dplyr::arrange(dplyr::desc(meanImp)) |>  -->
<!--   dplyr::slice_head(n = 10) |>  -->
<!--   dplyr::pull(rowname) -->
<!-- vi_top10 <- vi_rf_basic |> -->
<!--   dplyr::arrange(dplyr::desc(value)) |>  -->
<!--   dplyr::slice_head(n = 10) |>  -->
<!--   dplyr::pull(variable) -->
<!-- cbind(vi_top10, bor_top10) |>  -->
<!--   knitr::kable(col.names = c("RF Top 10", "Boruta Top 10")) -->
<!-- ``` -->
<p>For the spatial upscaling in the context of digital soil mapping, let’s retain only the variables deemed important (<code>"Confirmed"</code>) by the Boruta algorithm and retrain a final Random Forest model. The number of retained variables is 33.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get retained important variables</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>predictors_selected <span class="ot">&lt;-</span> df_bor <span class="sc">|&gt;</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(decision <span class="sc">==</span> <span class="st">"Confirmed"</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(rowname)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(predictors_selected)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 32</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># re-train Random Forest model</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>rf_bor <span class="ot">&lt;-</span> ranger<span class="sc">::</span><span class="fu">ranger</span>( </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> df_train[, target],              <span class="co"># target variable</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> df_train[, predictors_selected], <span class="co"># Predictor variables</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,                           <span class="co"># Specify the seed for randomization to reproduce the same model again</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">num.threads =</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>() <span class="sc">-</span> <span class="dv">1</span>) <span class="co"># Use all but one CPU core for quick model training</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># quick report and performance of trained model object</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>rf_bor</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Ranger result

Call:
 ranger::ranger(y = df_train[, target], x = df_train[, predictors_selected],      seed = 42, num.threads = parallel::detectCores() - 1) 

Type:                             Regression 
Number of trees:                  500 
Sample size:                      605 
Number of independent variables:  32 
Mtry:                             5 
Target node size:                 5 
Variable importance mode:         none 
Splitrule:                        variance 
OOB prediction error (MSE):       0.3121996 
R squared (OOB):                  0.4715675 </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Compare the skill of the models with all predictors_all and with the Boruta-informed reduced set of predictors_all. What is happening?</p>
</div>
</div>
<p>Save the model object with the reduced set of predictors_all, calibration, and validation data for the subsequent Chapter.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save relevant data for model testing in the next chapter.</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(rf_bor,                   </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>        here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data/rf_for_ph0-10.rds"</span>))</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(df_train[, <span class="fu">c</span>(target, predictors_selected)],</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>        here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data/cal_for_ph0-10.rds"</span>))</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(df_test[, <span class="fu">c</span>(target, predictors_selected)],</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>        here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data/val_for_ph0-10.rds"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" data-line-spacing="2" role="list" style="display: none">
<div id="ref-dawson77" class="csl-entry" role="listitem">
Dawson, G. A. (1977). Atmospheric ammonia from undisturbed land. <em>Journal of Geophysical Research (1896-1977)</em>, <em>82</em>(21), 3125–3133. <a href="https://doi.org/10.1029/JC082i021p03125">https://doi.org/10.1029/JC082i021p03125</a>
</div>
<div id="ref-kursa10" class="csl-entry" role="listitem">
Kursa, M. B., &amp; Rudnicki, W. R. (2010). Feature <span>Selection</span> with the <span>Boruta</span> <span>Package</span>. <em>Journal of Statistical Software</em>, <em>36</em>(11), 1–13. <a href="https://doi.org/10.18637/jss.v036.i11">https://doi.org/10.18637/jss.v036.i11</a>
</div>
<div id="ref-ludwig23" class="csl-entry" role="listitem">
Ludwig, M., Moreno-Martinez, A., Hölzel, N., Pebesma, E., &amp; Meyer, H. (2023). Assessing and improving the transferability of current global spatial prediction models. <em>Global Ecology and Biogeography</em>, <em>32</em>(3), 356–368. <a href="https://doi.org/10.1111/geb.13635">https://doi.org/10.1111/geb.13635</a>
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./02-data_preparation.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data preparation</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./04-model_test.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Model Analysis</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>