<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>AGDS 2: Digital Soil Mapping - 2&nbsp; Data preparation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./03-model_training.html" rel="next">
<link href="./01-introduction.html" rel="prev">
<link href="./figures/favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta name="twitter:title" content="AGDS 2: Digital Soil Mapping - 2&nbsp; Data preparation">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="02-data_preparation_files/figure-html/unnamed-chunk-4-1.png">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="./images/logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title"></span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/geco-bern/tutorial_digital_soil_mapping" rel="" target=""><i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" rel="" target="" aria-current="page">
 <span class="menu-text">Home</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./02-data_preparation.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data preparation</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-data_preparation.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data preparation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-model_training.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Train a Random Forest</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-model_test.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Model Analysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./99-exercise.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Report Exercise</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./99-variables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Variables</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#load-data" id="toc-load-data" class="nav-link active" data-scroll-target="#load-data"><span class="header-section-number">2.1</span> Load data</a>
  <ul class="collapse">
  <li><a href="#soil-samples" id="toc-soil-samples" class="nav-link" data-scroll-target="#soil-samples"><span class="header-section-number">2.1.1</span> Soil samples</a></li>
  <li><a href="#environmental-covariates" id="toc-environmental-covariates" class="nav-link" data-scroll-target="#environmental-covariates"><span class="header-section-number">2.1.2</span> Environmental covariates</a></li>
  </ul></li>
  <li><a href="#visualise-data" id="toc-visualise-data" class="nav-link" data-scroll-target="#visualise-data"><span class="header-section-number">2.2</span> Visualise data</a></li>
  <li><a href="#combine-data" id="toc-combine-data" class="nav-link" data-scroll-target="#combine-data"><span class="header-section-number">2.3</span> Combine data</a></li>
  <li><a href="#more-data-wrangling" id="toc-more-data-wrangling" class="nav-link" data-scroll-target="#more-data-wrangling"><span class="header-section-number">2.4</span> More data wrangling</a></li>
  <li><a href="#checking-missing-data" id="toc-checking-missing-data" class="nav-link" data-scroll-target="#checking-missing-data"><span class="header-section-number">2.5</span> Checking missing data</a></li>
  <li><a href="#save-data" id="toc-save-data" class="nav-link" data-scroll-target="#save-data"><span class="header-section-number">2.6</span> Save data</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-dataprep" class="quarto-section-identifier"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data preparation</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="load-data" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="load-data"><span class="header-section-number">2.1</span> Load data</h2>
<p>The data required for ditigal soil mapping are:</p>
<ul>
<li>Soil samples of variables measured in the field. These observations need to be geo-located and are used as the target for the model that is then used for spatial upscaling.</li>
<li>Environmental covariates, provided as geospatial raster maps. These covariates act as predictors in the model that is used for spatial upscaling.</li>
</ul>
<p>Let’s load them</p>
<section id="soil-samples" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="soil-samples"><span class="header-section-number">2.1.1</span> Soil samples</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load soil data from sampling locations</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>df_obs <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data-raw/soildata/berne_soil_sampling_locations.csv"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Display data</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_obs) <span class="sc">|&gt;</span> </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 8%">
<col style="width: 6%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 9%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">site_id_unique</th>
<th style="text-align: left;">timeset</th>
<th style="text-align: right;">x</th>
<th style="text-align: right;">y</th>
<th style="text-align: left;">dataset</th>
<th style="text-align: left;">dclass</th>
<th style="text-align: right;">waterlog.30</th>
<th style="text-align: right;">waterlog.50</th>
<th style="text-align: right;">waterlog.100</th>
<th style="text-align: right;">ph.0.10</th>
<th style="text-align: right;">ph.10.30</th>
<th style="text-align: right;">ph.30.50</th>
<th style="text-align: right;">ph.50.100</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">4_26-In-005</td>
<td style="text-align: left;">d1968_1974_ptf</td>
<td style="text-align: right;">2571994</td>
<td style="text-align: right;">1203001</td>
<td style="text-align: left;">validation</td>
<td style="text-align: left;">poor</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6.071733</td>
<td style="text-align: right;">6.227780</td>
<td style="text-align: right;">7.109235</td>
<td style="text-align: right;">7.214589</td>
</tr>
<tr class="even">
<td style="text-align: left;">4_26-In-006</td>
<td style="text-align: left;">d1974_1978</td>
<td style="text-align: right;">2572149</td>
<td style="text-align: right;">1202965</td>
<td style="text-align: left;">calibration</td>
<td style="text-align: left;">poor</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6.900000</td>
<td style="text-align: right;">6.947128</td>
<td style="text-align: right;">7.203502</td>
<td style="text-align: right;">7.700000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">4_26-In-012</td>
<td style="text-align: left;">d1974_1978</td>
<td style="text-align: right;">2572937</td>
<td style="text-align: right;">1203693</td>
<td style="text-align: left;">calibration</td>
<td style="text-align: left;">moderate</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6.200000</td>
<td style="text-align: right;">6.147128</td>
<td style="text-align: right;">5.603502</td>
<td style="text-align: right;">5.904355</td>
</tr>
<tr class="even">
<td style="text-align: left;">4_26-In-014</td>
<td style="text-align: left;">d1974_1978</td>
<td style="text-align: right;">2573374</td>
<td style="text-align: right;">1203710</td>
<td style="text-align: left;">validation</td>
<td style="text-align: left;">well</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6.600000</td>
<td style="text-align: right;">6.754607</td>
<td style="text-align: right;">7.200000</td>
<td style="text-align: right;">7.151129</td>
</tr>
<tr class="odd">
<td style="text-align: left;">4_26-In-015</td>
<td style="text-align: left;">d1968_1974_ptf</td>
<td style="text-align: right;">2573553</td>
<td style="text-align: right;">1203935</td>
<td style="text-align: left;">validation</td>
<td style="text-align: left;">moderate</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6.272715</td>
<td style="text-align: right;">6.272715</td>
<td style="text-align: right;">6.718392</td>
<td style="text-align: right;">7.269008</td>
</tr>
<tr class="even">
<td style="text-align: left;">4_26-In-016</td>
<td style="text-align: left;">d1968_1974_ptf</td>
<td style="text-align: right;">2573310</td>
<td style="text-align: right;">1204328</td>
<td style="text-align: left;">calibration</td>
<td style="text-align: left;">poor</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6.272715</td>
<td style="text-align: right;">6.160700</td>
<td style="text-align: right;">5.559031</td>
<td style="text-align: right;">5.161655</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The dataset on soil samples from Bern holds 13 variables for 1052 entries (more information <a href="https://rdrr.io/cran/geoGAM/man/berne.html">here</a>):</p>
<ul>
<li><p><code>site_id_unique</code>: The location’s unique site id.</p></li>
<li><p><code>timeset</code>: The sampling year and information on sampling type for soil pH (no label: CaCl<span class="math inline">\(_2\)</span> laboratory measurement, field: indicator solution used in field, ptf: H<span class="math inline">\(_2\)</span>O laboratory measurement transferred by pedotransfer function).</p></li>
<li><p><code>x</code>: The x (easting) coordinates in meters following the (CH1903/LV03) system.</p></li>
<li><p><code>y</code>: The y (northing) coordinates in meters following the (CH1903/LV03) system.</p></li>
<li><p><code>dataset</code>: Specification whether a sample is used for model training (<code>"calibration"</code>) or testing (<code>"validation"</code>) (this is based on randomization to ensure even spatial coverage).</p></li>
<li><p><code>dclass</code>: Soil drainage class</p></li>
<li><p><code>waterlog.30</code>, <code>waterlog.50</code>, <code>waterlog.100</code>: Specification whether soil was water logged at 30, 50, or 100 cm depth (0 = No, 1 = Yes).</p></li>
<li><p><code>ph.0.10</code>, <code>ph.10.30</code>, <code>ph.30.50</code>, <code>ph.50.100</code>: Average soil pH between 0-10, 10-30, 30-50, and 50-100 cm depth.</p></li>
</ul>
</section>
<section id="environmental-covariates" class="level3" data-number="2.1.2">
<h3 data-number="2.1.2" class="anchored" data-anchor-id="environmental-covariates"><span class="header-section-number">2.1.2</span> Environmental covariates</h3>
<p>Now, let’s load the covariates that we want to produce our soil maps with. These files are in the <a href="https://en.wikipedia.org/wiki/GeoTIFF">geoTIFF</a> format - geolocated TIFF files.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get a list with the path to all raster files</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>list_raster <span class="ot">&lt;-</span> <span class="fu">list.files</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data-raw/geodata/covariates/"</span>),</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">full.names =</span> <span class="cn">TRUE</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Display data (lapply to clean names)</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  list_raster, </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) <span class="fu">sub</span>(<span class="st">".*/(.*)"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, x)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>() <span class="sc">|&gt;</span> </span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">5</span>) <span class="sc">|&gt;</span> </span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "NegO.tif"         "PosO.tif"         "Se_MRRTF2m.tif"   "Se_MRVBF2m.tif"  
[5] "Se_NO2m_r500.tif"</code></pre>
</div>
</div>
<p>The output above shows the first five raster files with rather cryptic names. The meaning of all 91 raster files are given in <a href="99-variables.html"><span>Chapter&nbsp;6</span></a>. Make sure to have a look at that list as it will help you to interpret your model results later on. Let’s look at one of these raster files, <code>Se_slope2m.tif</code>, to get a better understanding for our data. That file contains the local slope of the terrain, derived from a digital elevation model with 2 m resolution:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load a raster file as example: Picking the slope profile at 2 m resolution</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>raster_example <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data-raw/geodata/covariates/Se_slope2m.tif"</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>raster_example</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>class       : SpatRaster 
dimensions  : 986, 2428, 1  (nrow, ncol, nlyr)
resolution  : 20, 20  (x, y)
extent      : 2568140, 2616700, 1200740, 1220460  (xmin, xmax, ymin, ymax)
coord. ref. : CH1903+ / LV95 
source      : Se_slope2m.tif 
name        : Se_slope2m 
min value   :    0.00000 
max value   :   85.11286 </code></pre>
</div>
</div>
<p>As shown in the output, a raster object has the following properties (among others, see <code>?terra::rast</code>):</p>
<ul>
<li><p>class: The class of the file, here a SpatRaster.</p></li>
<li><p>dimensions: The number of rows, columns, years (if temporal encoding).</p></li>
<li><p>resolution: The resolution of the coordinate system, here it is 20 in both axes.</p></li>
<li><p>extent: The extent of the coordinate system defined by min and max values on the x and y axes.</p></li>
<li><p>coord. ref.: Reference coordinate system. Here, the raster is encoded using the LV95 geodetic reference system from which the projected coordinate system CH1903+ is derived.</p></li>
<li><p>source: The name of the source file.</p></li>
<li><p>names: The name of the raster file (mostly the file name without file-specific ending)</p></li>
<li><p>min value: The lowest value of all cells.</p></li>
<li><p>max value: The highest value of all cells.</p></li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The code chunks filtered for a random sub-sample of 15 variables. As described in <a href="99-exercise.html"><span>Chapter&nbsp;5</span></a>, your task will be to investigate all covariates and find the ones that can best be used for your modelling task.</p>
</div>
</div>
</section>
</section>
<section id="visualise-data" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="visualise-data"><span class="header-section-number">2.2</span> Visualise data</h2>
<p>Now, let’s look at a visualisation of this raster file. Since we have selected the slope at 2 m resolution, we expect a relief-like map with a color gradient that indicates the steepness of the terrain. A quick way to look at a raster object is to use the generic <code>plot()</code> function.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot raster example</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(raster_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="02-data_preparation_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>To have more flexibility with visualising the data, we can use the <code>ggplot()</code> in combination with the {tidyterra} package.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyterra)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># To have some more flexibility, we can plot this in the ggplot-style as such:</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  tidyterra<span class="sc">::</span><span class="fu">geom_spatraster</span>(<span class="at">data =</span> raster_example) <span class="sc">+</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_viridis_c</span>(</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.value =</span> <span class="cn">NA</span>,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">option =</span> <span class="st">"magma"</span>,</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Slope (%) </span><span class="sc">\n</span><span class="st">"</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span>  <span class="co"># avoid gap between plotting area and axis</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Slope of the Study Area"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="02-data_preparation_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that the second plot has different coordinates than the upper one. That is because the data was automatically projected to the World Geodetic System (WGS84, ESPG: 4326).</p>
</div>
</div>
<p>This looks already interesting but we can put our data into a bit more context. For example, a larger map background would be useful to get a better orientation of our location. Also, it would be nice to see where our sampling locations are and to differentiate these locations by whether they are part of the training or testing dataset. Bringing this all together requires some more understanding of plotting maps in <code>R</code>. So, don’t worry if you do not understand everything in the code chunk below and enjoy the visualizations:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To get our map working correctly, we have to ensure that all the input data</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># is in the same coordinate system. Since our Bern data is in the Swiss </span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># coordinate system, we have to transform the sampling locations to the </span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># World Geodetic System first.</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># To look up EPSG Codes: https://epsg.io/</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># World Geodetic System 1984:  4326</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Swiss CH1903+ / LV95: 2056</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co"># For the raster:</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>rasta <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">project</span>(raster_example, <span class="st">"+init=EPSG:4326"</span>)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's make a function for transforming the sampling locations:</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>change_coords <span class="ot">&lt;-</span> <span class="cf">function</span>(data, from_CRS, to_CRS) {</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if data input is correct</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(<span class="fu">names</span>(data) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"lat"</span>, <span class="st">"lon"</span>))) {</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Input data needs variables: id, lat, lon"</span>)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create simple feature for old CRS</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  sf_old_crs <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_as_sf</span>(data, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>), <span class="at">crs =</span> from_CRS)</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Transform to new CRS</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  sf_new_crs     <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(sf_old_crs, <span class="at">crs =</span> to_CRS)</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>  sf_new_crs<span class="sc">$</span>lat <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_coordinates</span>(sf_new_crs)[, <span class="st">"Y"</span>]</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>  sf_new_crs<span class="sc">$</span>lon <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_coordinates</span>(sf_new_crs)[, <span class="st">"X"</span>]</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>  sf_new_crs <span class="ot">&lt;-</span> sf_new_crs <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(id, lat, lon)</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return new CRS</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(sf_new_crs)</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform dataframes</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>coord_train <span class="ot">&lt;-</span> df_obs <span class="sc">|&gt;</span> </span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(dataset <span class="sc">==</span> <span class="st">"calibration"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(site_id_unique, x, y) <span class="sc">|&gt;</span> </span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">id =</span> site_id_unique, <span class="at">lon =</span> x, <span class="at">lat =</span> y) <span class="sc">|&gt;</span> </span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">change_coords</span>(</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">from_CRS =</span> <span class="dv">2056</span>, </span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">to_CRS =</span> <span class="dv">4326</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>coord_test <span class="ot">&lt;-</span> df_obs <span class="sc">|&gt;</span> </span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(dataset <span class="sc">==</span> <span class="st">"validation"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(site_id_unique, x, y) <span class="sc">|&gt;</span> </span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">id =</span> site_id_unique, <span class="at">lon =</span> x, <span class="at">lat =</span> y) <span class="sc">|&gt;</span> </span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">change_coords</span>(</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">from_CRS =</span> <span class="dv">2056</span>, </span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">to_CRS =</span> <span class="dv">4326</span></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Notes: </span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># - This code may only work when installing the development branch of {leaflet}:</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># remotes::install_github('rstudio/leaflet')</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># - You might have to do library(terra) for R to find functions needed in the backend</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's get a nice color palette now for easy reference</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>pal <span class="ot">&lt;-</span> leaflet<span class="sc">::</span><span class="fu">colorNumeric</span>(</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"magma"</span>,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">values</span>(r),</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">na.color =</span> <span class="st">"transparent"</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Next, we build a leaflet map</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>leaflet<span class="sc">::</span><span class="fu">leaflet</span>() <span class="sc">|&gt;</span> </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># As base maps, use two provided by ESRI</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  leaflet<span class="sc">::</span><span class="fu">addProviderTiles</span>(leaflet<span class="sc">::</span>providers<span class="sc">$</span>Esri.WorldImagery, <span class="at">group =</span> <span class="st">"World Imagery"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  leaflet<span class="sc">::</span><span class="fu">addProviderTiles</span>(leaflet<span class="sc">::</span>providers<span class="sc">$</span>Esri.WorldTopoMap, <span class="at">group =</span> <span class="st">"World Topo"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add our raster file</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  leaflet<span class="sc">::</span><span class="fu">addRasterImage</span>(</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    rasta,</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">colors =</span> pal,</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">opacity =</span> <span class="fl">0.6</span>,</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> <span class="st">"raster"</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add markers for sampling locations</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>  leaflet<span class="sc">::</span><span class="fu">addCircleMarkers</span>(</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> coord_train,</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">lng =</span> <span class="sc">~</span>lon,  <span class="co"># Column name for x coordinates</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> <span class="sc">~</span>lat,  <span class="co"># Column name for y coordinates</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> <span class="st">"training"</span>,</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"black"</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>    leaflet<span class="sc">::</span><span class="fu">addCircleMarkers</span>(</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> coord_test,</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">lng =</span> <span class="sc">~</span>lon,  <span class="co"># Column name for x coordinates</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> <span class="sc">~</span>lat,  <span class="co"># Column name for y coordinates</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> <span class="st">"validation"</span>,</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"red"</span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add some layout and legend</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>  leaflet<span class="sc">::</span><span class="fu">addLayersControl</span>(</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">baseGroups =</span> <span class="fu">c</span>(<span class="st">"World Imagery"</span>,<span class="st">"World Topo"</span>),</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="st">"topleft"</span>,</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">options =</span> leaflet<span class="sc">::</span><span class="fu">layersControlOptions</span>(<span class="at">collapsed =</span> <span class="cn">FALSE</span>),</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">overlayGroups =</span> <span class="fu">c</span>(<span class="st">"raster"</span>, <span class="st">"training"</span>, <span class="st">"validation"</span>)</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>  leaflet<span class="sc">::</span><span class="fu">addLegend</span>(</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">pal =</span> pal,</span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> terra<span class="sc">::</span><span class="fu">values</span>(r),</span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Slope (%)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This plotting example is based to the one shown in the AGDS 2 tutorial “Handful of Pixels” on phenology. More information on using spatial data in R can be found there in the Chapter on <a href="https://geco-bern.github.io/handfull_of_pixels/geospatial_R.html">Geospatial data in R</a>.</p>
</div>
</div>
<p>That looks great! At a first glance, it is a bit crowded but once you zoom in, you can investigate our study area quite nicely. You can check whether the slope raster file makes sense by comparing it against the base maps. Can you see how cliffs along the Aare river, hills, and even gravel quarries show high slope values. We also see that our testing dataset is randomly distributed across the area covered by the training dataset.</p>
</section>
<section id="combine-data" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="combine-data"><span class="header-section-number">2.3</span> Combine data</h2>
<p>Now that we have played with a few visualizations, let’s get back to preparing our data. The {terra} package comes with the very useful tool to stack multiple rasters on top of each other if they share the spatial grid (extent and resolution). To do so, we just have to feed in the vector of file names <code>list_raster</code>:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load all files as one batch</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>all_rasters <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(list_raster)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>all_rasters</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>class       : SpatRaster 
dimensions  : 986, 2428, 91  (nrow, ncol, nlyr)
resolution  : 20, 20  (x, y)
extent      : 2568140, 2616700, 1200740, 1220460  (xmin, xmax, ymin, ymax)
coord. ref. : CH1903+ / LV95 
sources     : NegO.tif  
              PosO.tif  
              Se_MRRTF2m.tif  
              ... and 88 more source(s)
names       :      NegO,      PosO, Se_MRRTF2m, Se_MRVBF2m, Se_NO2m_r500, Se_PO2m_r500, ... 
min values  : 0.8109335, 0.8742412,   0.000000,   0.000000,    0.2755551,    0.3541574, ... 
max values  : 1.5921584, 1.6218545,   6.965698,   7.991423,    1.6376855,    1.6430260, ... </code></pre>
</div>
</div>
<p>Note that above, we have stacked only a random of all available raster data (<code>list_raster</code>) which we have generated previously.</p>
<p>Now, we do not want to have the covariates’ data from all cells in the raster file. Rather, we want to reduce our stacked rasters to the x and y coordinates for which we have soil sampling data. We can do this using the <code>terra::extract()</code> function. Then, we want to merge the two dataframes of soil data and covariates data by their coordinates. Since number of rows and the order of the covariate data is the same as the “Bern data” (soil samples), we can simply bind their columns with <code>cbind()</code>:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract coordinates from sampling locations</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>sampling_xy <span class="ot">&lt;-</span> df_obs <span class="sc">|&gt;</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(x, y)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># From all rasters, extract values for sampling coordinates</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>df_covars <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">extract</span>(</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  all_rasters,  <span class="co"># The raster we want to extract from</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  sampling_xy,  <span class="co"># A matrix of x and y values to extract for</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">ID =</span> <span class="cn">FALSE</span>    <span class="co"># To not add a default ID column to the output</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>df_full <span class="ot">&lt;-</span> <span class="fu">cbind</span>(df_obs, df_covars)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_full) <span class="sc">|&gt;</span> </span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 1%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 0%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 1%">
<col style="width: 0%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 0%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 1%">
<col style="width: 0%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 0%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 0%">
<col style="width: 1%">
<col style="width: 0%">
<col style="width: 1%">
<col style="width: 0%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 0%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 1%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 1%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">site_id_unique</th>
<th style="text-align: left;">timeset</th>
<th style="text-align: right;">x</th>
<th style="text-align: right;">y</th>
<th style="text-align: left;">dataset</th>
<th style="text-align: left;">dclass</th>
<th style="text-align: right;">waterlog.30</th>
<th style="text-align: right;">waterlog.50</th>
<th style="text-align: right;">waterlog.100</th>
<th style="text-align: right;">ph.0.10</th>
<th style="text-align: right;">ph.10.30</th>
<th style="text-align: right;">ph.30.50</th>
<th style="text-align: right;">ph.50.100</th>
<th style="text-align: right;">NegO</th>
<th style="text-align: right;">PosO</th>
<th style="text-align: right;">Se_MRRTF2m</th>
<th style="text-align: right;">Se_MRVBF2m</th>
<th style="text-align: right;">Se_NO2m_r500</th>
<th style="text-align: right;">Se_PO2m_r500</th>
<th style="text-align: right;">Se_SAR2m</th>
<th style="text-align: right;">Se_SCA2m</th>
<th style="text-align: right;">Se_TWI2m</th>
<th style="text-align: right;">Se_TWI2m_s15</th>
<th style="text-align: right;">Se_TWI2m_s60</th>
<th style="text-align: right;">Se_alti2m_std_50c</th>
<th style="text-align: right;">Se_conv2m</th>
<th style="text-align: right;">Se_curv25m</th>
<th style="text-align: right;">Se_curv2m</th>
<th style="text-align: right;">Se_curv2m_fmean_50c</th>
<th style="text-align: right;">Se_curv2m_fmean_5c</th>
<th style="text-align: right;">Se_curv2m_s60</th>
<th style="text-align: right;">Se_curv2m_std_50c</th>
<th style="text-align: right;">Se_curv2m_std_5c</th>
<th style="text-align: right;">Se_curv50m</th>
<th style="text-align: right;">Se_curv6m</th>
<th style="text-align: right;">Se_curvplan25m</th>
<th style="text-align: right;">Se_curvplan2m</th>
<th style="text-align: right;">Se_curvplan2m_fmean_50c</th>
<th style="text-align: right;">Se_curvplan2m_fmean_5c</th>
<th style="text-align: right;">Se_curvplan2m_s60</th>
<th style="text-align: right;">Se_curvplan2m_s7</th>
<th style="text-align: right;">Se_curvplan2m_std_50c</th>
<th style="text-align: right;">Se_curvplan2m_std_5c</th>
<th style="text-align: right;">Se_curvplan50m</th>
<th style="text-align: right;">Se_curvprof25m</th>
<th style="text-align: right;">Se_curvprof2m</th>
<th style="text-align: right;">Se_curvprof2m_fmean_50c</th>
<th style="text-align: right;">Se_curvprof2m_fmean_5c</th>
<th style="text-align: right;">Se_curvprof2m_s60</th>
<th style="text-align: right;">Se_curvprof2m_s7</th>
<th style="text-align: right;">Se_curvprof2m_std_50c</th>
<th style="text-align: right;">Se_curvprof2m_std_5c</th>
<th style="text-align: right;">Se_curvprof50m</th>
<th style="text-align: right;">Se_diss2m_50c</th>
<th style="text-align: right;">Se_diss2m_5c</th>
<th style="text-align: right;">Se_e_aspect25m</th>
<th style="text-align: right;">Se_e_aspect2m</th>
<th style="text-align: right;">Se_e_aspect2m_5c</th>
<th style="text-align: right;">Se_e_aspect50m</th>
<th style="text-align: right;">Se_n_aspect2m</th>
<th style="text-align: right;">Se_n_aspect2m_50c</th>
<th style="text-align: right;">Se_n_aspect2m_5c</th>
<th style="text-align: right;">Se_n_aspect50m</th>
<th style="text-align: right;">Se_n_aspect6m</th>
<th style="text-align: right;">Se_rough2m_10c</th>
<th style="text-align: right;">Se_rough2m_5c</th>
<th style="text-align: right;">Se_rough2m_rect3c</th>
<th style="text-align: right;">Se_slope2m</th>
<th style="text-align: right;">Se_slope2m_fmean_50c</th>
<th style="text-align: right;">Se_slope2m_fmean_5c</th>
<th style="text-align: right;">Se_slope2m_s60</th>
<th style="text-align: right;">Se_slope2m_s7</th>
<th style="text-align: right;">Se_slope2m_std_50c</th>
<th style="text-align: right;">Se_slope2m_std_5c</th>
<th style="text-align: right;">Se_slope50m</th>
<th style="text-align: right;">Se_slope6m</th>
<th style="text-align: right;">Se_toposcale2m_r3_r50_i10s</th>
<th style="text-align: right;">Se_tpi_2m_50c</th>
<th style="text-align: right;">Se_tpi_2m_5c</th>
<th style="text-align: right;">Se_tri2m_altern_3c</th>
<th style="text-align: right;">Se_tsc10_2m</th>
<th style="text-align: right;">Se_vrm2m</th>
<th style="text-align: right;">Se_vrm2m_r10c</th>
<th style="text-align: right;">be_gwn25_hdist</th>
<th style="text-align: right;">be_gwn25_vdist</th>
<th style="text-align: right;">cindx10_25</th>
<th style="text-align: right;">cindx50_25</th>
<th style="text-align: right;">geo500h1id</th>
<th style="text-align: right;">geo500h3id</th>
<th style="text-align: right;">lgm</th>
<th style="text-align: right;">lsf</th>
<th style="text-align: right;">mrrtf25</th>
<th style="text-align: right;">mrvbf25</th>
<th style="text-align: right;">mt_gh_y</th>
<th style="text-align: right;">mt_rr_y</th>
<th style="text-align: right;">mt_td_y</th>
<th style="text-align: right;">mt_tt_y</th>
<th style="text-align: right;">mt_ttvar</th>
<th style="text-align: right;">protindx</th>
<th style="text-align: right;">terrTextur</th>
<th style="text-align: right;">tsc25_18</th>
<th style="text-align: right;">tsc25_40</th>
<th style="text-align: right;">vdcn25</th>
<th style="text-align: right;">vszone</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">4_26-In-005</td>
<td style="text-align: left;">d1968_1974_ptf</td>
<td style="text-align: right;">2571994</td>
<td style="text-align: right;">1203001</td>
<td style="text-align: left;">validation</td>
<td style="text-align: left;">poor</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6.071733</td>
<td style="text-align: right;">6.227780</td>
<td style="text-align: right;">7.109235</td>
<td style="text-align: right;">7.214589</td>
<td style="text-align: right;">1.569110</td>
<td style="text-align: right;">1.534734</td>
<td style="text-align: right;">5.930607</td>
<td style="text-align: right;">6.950892</td>
<td style="text-align: right;">1.562085</td>
<td style="text-align: right;">1.548762</td>
<td style="text-align: right;">4.000910</td>
<td style="text-align: right;">16.248077</td>
<td style="text-align: right;">0.0011592</td>
<td style="text-align: right;">0.0032796</td>
<td style="text-align: right;">0.0049392</td>
<td style="text-align: right;">0.3480562</td>
<td style="text-align: right;">-40.5395088</td>
<td style="text-align: right;">-0.0014441</td>
<td style="text-align: right;">-1.9364884</td>
<td style="text-align: right;">-0.0062570</td>
<td style="text-align: right;">0.0175912</td>
<td style="text-align: right;">0.0002296</td>
<td style="text-align: right;">2.9204133</td>
<td style="text-align: right;">1.1769447</td>
<td style="text-align: right;">0.0031319</td>
<td style="text-align: right;">-0.5886537</td>
<td style="text-align: right;">-0.0042508</td>
<td style="text-align: right;">-1.0857303</td>
<td style="text-align: right;">-0.0445323</td>
<td style="text-align: right;">-0.0481024</td>
<td style="text-align: right;">-0.0504083</td>
<td style="text-align: right;">-0.1655090</td>
<td style="text-align: right;">1.5687343</td>
<td style="text-align: right;">0.6229440</td>
<td style="text-align: right;">0.0007920</td>
<td style="text-align: right;">-0.0028067</td>
<td style="text-align: right;">0.8507581</td>
<td style="text-align: right;">-0.0382753</td>
<td style="text-align: right;">-0.0656936</td>
<td style="text-align: right;">-0.0506380</td>
<td style="text-align: right;">-0.0732220</td>
<td style="text-align: right;">1.6507173</td>
<td style="text-align: right;">0.7082230</td>
<td style="text-align: right;">-0.0023399</td>
<td style="text-align: right;">0.3934371</td>
<td style="text-align: right;">0.1770810</td>
<td style="text-align: right;">-0.9702092</td>
<td style="text-align: right;">-0.5661940</td>
<td style="text-align: right;">-0.7929600</td>
<td style="text-align: right;">-0.9939429</td>
<td style="text-align: right;">-0.2402939</td>
<td style="text-align: right;">-0.2840056</td>
<td style="text-align: right;">-0.6084610</td>
<td style="text-align: right;">-0.0577110</td>
<td style="text-align: right;">-0.7661251</td>
<td style="text-align: right;">0.3228087</td>
<td style="text-align: right;">0.2241062</td>
<td style="text-align: right;">0.2003846</td>
<td style="text-align: right;">1.1250136</td>
<td style="text-align: right;">0.9428899</td>
<td style="text-align: right;">0.6683306</td>
<td style="text-align: right;">0.9333237</td>
<td style="text-align: right;">0.7310556</td>
<td style="text-align: right;">0.8815832</td>
<td style="text-align: right;">0.3113754</td>
<td style="text-align: right;">0.3783818</td>
<td style="text-align: right;">0.5250366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">-0.0940372</td>
<td style="text-align: right;">-0.0583917</td>
<td style="text-align: right;">10.319408</td>
<td style="text-align: right;">0.4645128</td>
<td style="text-align: right;">0.0002450</td>
<td style="text-align: right;">0.000125</td>
<td style="text-align: right;">234.39087</td>
<td style="text-align: right;">1.2986320</td>
<td style="text-align: right;">-10.62191</td>
<td style="text-align: right;">-6.9658718</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0.0770846</td>
<td style="text-align: right;">0.0184651</td>
<td style="text-align: right;">4.977099</td>
<td style="text-align: right;">1316.922</td>
<td style="text-align: right;">9931.120</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">98</td>
<td style="text-align: right;">183</td>
<td style="text-align: right;">0.0159717</td>
<td style="text-align: right;">0.6248673</td>
<td style="text-align: right;">0.3332805</td>
<td style="text-align: right;">1.784737</td>
<td style="text-align: right;">65.62196</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="even">
<td style="text-align: left;">4_26-In-006</td>
<td style="text-align: left;">d1974_1978</td>
<td style="text-align: right;">2572149</td>
<td style="text-align: right;">1202965</td>
<td style="text-align: left;">calibration</td>
<td style="text-align: left;">poor</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6.900000</td>
<td style="text-align: right;">6.947128</td>
<td style="text-align: right;">7.203502</td>
<td style="text-align: right;">7.700000</td>
<td style="text-align: right;">1.568917</td>
<td style="text-align: right;">1.533827</td>
<td style="text-align: right;">5.984921</td>
<td style="text-align: right;">6.984581</td>
<td style="text-align: right;">1.543384</td>
<td style="text-align: right;">1.558683</td>
<td style="text-align: right;">4.001326</td>
<td style="text-align: right;">3.357315</td>
<td style="text-align: right;">0.0139006</td>
<td style="text-align: right;">0.0070509</td>
<td style="text-align: right;">0.0067992</td>
<td style="text-align: right;">0.1484705</td>
<td style="text-align: right;">19.0945148</td>
<td style="text-align: right;">-0.0190294</td>
<td style="text-align: right;">2.1377332</td>
<td style="text-align: right;">0.0021045</td>
<td style="text-align: right;">0.0221433</td>
<td style="text-align: right;">0.0000390</td>
<td style="text-align: right;">3.8783867</td>
<td style="text-align: right;">4.3162045</td>
<td style="text-align: right;">-0.0171786</td>
<td style="text-align: right;">0.1278165</td>
<td style="text-align: right;">-0.0119618</td>
<td style="text-align: right;">-0.3522736</td>
<td style="text-align: right;">-0.0501855</td>
<td style="text-align: right;">-0.3270764</td>
<td style="text-align: right;">-0.1004921</td>
<td style="text-align: right;">-0.5133076</td>
<td style="text-align: right;">2.0736780</td>
<td style="text-align: right;">2.2502327</td>
<td style="text-align: right;">-0.0073879</td>
<td style="text-align: right;">0.0070676</td>
<td style="text-align: right;">-2.4900069</td>
<td style="text-align: right;">-0.0522900</td>
<td style="text-align: right;">-0.3492197</td>
<td style="text-align: right;">-0.1005311</td>
<td style="text-align: right;">-0.4981292</td>
<td style="text-align: right;">2.1899190</td>
<td style="text-align: right;">2.4300070</td>
<td style="text-align: right;">0.0097907</td>
<td style="text-align: right;">0.4014700</td>
<td style="text-align: right;">0.7360508</td>
<td style="text-align: right;">0.5683194</td>
<td style="text-align: right;">-0.3505180</td>
<td style="text-align: right;">0.8753148</td>
<td style="text-align: right;">0.3406741</td>
<td style="text-align: right;">0.4917848</td>
<td style="text-align: right;">-0.5732749</td>
<td style="text-align: right;">0.4801802</td>
<td style="text-align: right;">-0.4550385</td>
<td style="text-align: right;">0.7722272</td>
<td style="text-align: right;">0.2730940</td>
<td style="text-align: right;">0.2489859</td>
<td style="text-align: right;">0.2376962</td>
<td style="text-align: right;">1.3587183</td>
<td style="text-align: right;">1.0895698</td>
<td style="text-align: right;">0.9857153</td>
<td style="text-align: right;">1.0231543</td>
<td style="text-align: right;">1.0398037</td>
<td style="text-align: right;">1.0152543</td>
<td style="text-align: right;">0.5357812</td>
<td style="text-align: right;">0.0645478</td>
<td style="text-align: right;">0.5793087</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">-0.0014692</td>
<td style="text-align: right;">0.0180000</td>
<td style="text-align: right;">12.603136</td>
<td style="text-align: right;">0.5536283</td>
<td style="text-align: right;">0.0005389</td>
<td style="text-align: right;">0.000300</td>
<td style="text-align: right;">127.41681</td>
<td style="text-align: right;">1.7064546</td>
<td style="text-align: right;">-10.87862</td>
<td style="text-align: right;">-11.8201790</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0.0860347</td>
<td style="text-align: right;">0.0544361</td>
<td style="text-align: right;">4.975796</td>
<td style="text-align: right;">1317.000</td>
<td style="text-align: right;">9931.672</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">98</td>
<td style="text-align: right;">183</td>
<td style="text-align: right;">0.0204794</td>
<td style="text-align: right;">0.7573612</td>
<td style="text-align: right;">0.3395441</td>
<td style="text-align: right;">1.832904</td>
<td style="text-align: right;">69.16074</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">4_26-In-012</td>
<td style="text-align: left;">d1974_1978</td>
<td style="text-align: right;">2572937</td>
<td style="text-align: right;">1203693</td>
<td style="text-align: left;">calibration</td>
<td style="text-align: left;">moderate</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6.200000</td>
<td style="text-align: right;">6.147128</td>
<td style="text-align: right;">5.603502</td>
<td style="text-align: right;">5.904355</td>
<td style="text-align: right;">1.569093</td>
<td style="text-align: right;">1.543057</td>
<td style="text-align: right;">5.953919</td>
<td style="text-align: right;">6.990917</td>
<td style="text-align: right;">1.565405</td>
<td style="text-align: right;">1.563151</td>
<td style="text-align: right;">4.000320</td>
<td style="text-align: right;">11.330072</td>
<td style="text-align: right;">0.0011398</td>
<td style="text-align: right;">0.0021498</td>
<td style="text-align: right;">0.0017847</td>
<td style="text-align: right;">0.1112066</td>
<td style="text-align: right;">-9.1396294</td>
<td style="text-align: right;">0.0039732</td>
<td style="text-align: right;">-0.4178924</td>
<td style="text-align: right;">0.0009509</td>
<td style="text-align: right;">0.0431735</td>
<td style="text-align: right;">0.0034232</td>
<td style="text-align: right;">0.7022317</td>
<td style="text-align: right;">0.4170935</td>
<td style="text-align: right;">-0.0026431</td>
<td style="text-align: right;">-0.0183221</td>
<td style="text-align: right;">0.0015183</td>
<td style="text-align: right;">-0.2168447</td>
<td style="text-align: right;">-0.0079620</td>
<td style="text-align: right;">0.0053904</td>
<td style="text-align: right;">-0.0091239</td>
<td style="text-align: right;">-0.0110896</td>
<td style="text-align: right;">0.3974485</td>
<td style="text-align: right;">0.2292406</td>
<td style="text-align: right;">-0.0013561</td>
<td style="text-align: right;">-0.0024548</td>
<td style="text-align: right;">0.2010477</td>
<td style="text-align: right;">-0.0089129</td>
<td style="text-align: right;">-0.0377831</td>
<td style="text-align: right;">-0.0125471</td>
<td style="text-align: right;">-0.0052359</td>
<td style="text-align: right;">0.4158890</td>
<td style="text-align: right;">0.2700820</td>
<td style="text-align: right;">0.0012870</td>
<td style="text-align: right;">0.6717541</td>
<td style="text-align: right;">0.4404107</td>
<td style="text-align: right;">-0.6987815</td>
<td style="text-align: right;">-0.1960597</td>
<td style="text-align: right;">-0.3866692</td>
<td style="text-align: right;">-0.7592779</td>
<td style="text-align: right;">-0.9633239</td>
<td style="text-align: right;">-0.3006475</td>
<td style="text-align: right;">-0.9221049</td>
<td style="text-align: right;">-0.3257418</td>
<td style="text-align: right;">-0.9502072</td>
<td style="text-align: right;">0.2305476</td>
<td style="text-align: right;">0.2182523</td>
<td style="text-align: right;">0.1434273</td>
<td style="text-align: right;">0.7160403</td>
<td style="text-align: right;">0.5758902</td>
<td style="text-align: right;">0.5300468</td>
<td style="text-align: right;">0.5107915</td>
<td style="text-align: right;">0.5744110</td>
<td style="text-align: right;">0.4975456</td>
<td style="text-align: right;">0.2001768</td>
<td style="text-align: right;">0.1311051</td>
<td style="text-align: right;">0.4620202</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0340407</td>
<td style="text-align: right;">-0.0145804</td>
<td style="text-align: right;">7.100000</td>
<td style="text-align: right;">0.4850160</td>
<td style="text-align: right;">0.0000124</td>
<td style="text-align: right;">0.000000</td>
<td style="text-align: right;">143.41533</td>
<td style="text-align: right;">0.9372618</td>
<td style="text-align: right;">22.10210</td>
<td style="text-align: right;">0.2093917</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0.0737963</td>
<td style="text-align: right;">3.6830916</td>
<td style="text-align: right;">4.986864</td>
<td style="text-align: right;">1315.134</td>
<td style="text-align: right;">9935.438</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">98</td>
<td style="text-align: right;">183</td>
<td style="text-align: right;">0.0048880</td>
<td style="text-align: right;">0.7978453</td>
<td style="text-align: right;">0.4455501</td>
<td style="text-align: right;">1.981526</td>
<td style="text-align: right;">63.57096</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="even">
<td style="text-align: left;">4_26-In-014</td>
<td style="text-align: left;">d1974_1978</td>
<td style="text-align: right;">2573374</td>
<td style="text-align: right;">1203710</td>
<td style="text-align: left;">validation</td>
<td style="text-align: left;">well</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6.600000</td>
<td style="text-align: right;">6.754607</td>
<td style="text-align: right;">7.200000</td>
<td style="text-align: right;">7.151129</td>
<td style="text-align: right;">1.569213</td>
<td style="text-align: right;">1.542792</td>
<td style="text-align: right;">4.856076</td>
<td style="text-align: right;">6.964162</td>
<td style="text-align: right;">1.562499</td>
<td style="text-align: right;">1.562670</td>
<td style="text-align: right;">4.000438</td>
<td style="text-align: right;">42.167496</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">0.0008454</td>
<td style="text-align: right;">0.0021042</td>
<td style="text-align: right;">0.3710849</td>
<td style="text-align: right;">-0.9318936</td>
<td style="text-align: right;">-0.0371234</td>
<td style="text-align: right;">-0.0289909</td>
<td style="text-align: right;">0.0029348</td>
<td style="text-align: right;">-0.1056513</td>
<td style="text-align: right;">0.0127788</td>
<td style="text-align: right;">1.5150748</td>
<td style="text-align: right;">0.2413423</td>
<td style="text-align: right;">0.0020990</td>
<td style="text-align: right;">-0.0706228</td>
<td style="text-align: right;">-0.0113604</td>
<td style="text-align: right;">-0.0272214</td>
<td style="text-align: right;">-0.0301961</td>
<td style="text-align: right;">-0.0346193</td>
<td style="text-align: right;">-0.0273140</td>
<td style="text-align: right;">-0.0343277</td>
<td style="text-align: right;">0.8245047</td>
<td style="text-align: right;">0.1029889</td>
<td style="text-align: right;">-0.0041158</td>
<td style="text-align: right;">0.0257630</td>
<td style="text-align: right;">0.0017695</td>
<td style="text-align: right;">-0.0331309</td>
<td style="text-align: right;">0.0710320</td>
<td style="text-align: right;">-0.0400928</td>
<td style="text-align: right;">0.0529446</td>
<td style="text-align: right;">0.8635767</td>
<td style="text-align: right;">0.1616543</td>
<td style="text-align: right;">-0.0062147</td>
<td style="text-align: right;">0.4988544</td>
<td style="text-align: right;">0.4217250</td>
<td style="text-align: right;">-0.8485889</td>
<td style="text-align: right;">-0.8836724</td>
<td style="text-align: right;">-0.8657616</td>
<td style="text-align: right;">-0.8993938</td>
<td style="text-align: right;">-0.4677161</td>
<td style="text-align: right;">-0.5735765</td>
<td style="text-align: right;">-0.4998477</td>
<td style="text-align: right;">-0.4121092</td>
<td style="text-align: right;">-0.4782534</td>
<td style="text-align: right;">0.3859352</td>
<td style="text-align: right;">0.2732429</td>
<td style="text-align: right;">0.1554769</td>
<td style="text-align: right;">0.8482135</td>
<td style="text-align: right;">0.8873205</td>
<td style="text-align: right;">0.8635756</td>
<td style="text-align: right;">0.9015982</td>
<td style="text-align: right;">0.8518201</td>
<td style="text-align: right;">0.5767300</td>
<td style="text-align: right;">0.2149791</td>
<td style="text-align: right;">0.3928713</td>
<td style="text-align: right;">0.8432562</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0686932</td>
<td style="text-align: right;">-0.0085602</td>
<td style="text-align: right;">8.303085</td>
<td style="text-align: right;">0.3951114</td>
<td style="text-align: right;">0.0000857</td>
<td style="text-align: right;">0.000100</td>
<td style="text-align: right;">165.80418</td>
<td style="text-align: right;">0.7653937</td>
<td style="text-align: right;">-20.11569</td>
<td style="text-align: right;">-7.7729993</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0.0859686</td>
<td style="text-align: right;">0.0075817</td>
<td style="text-align: right;">5.285522</td>
<td style="text-align: right;">1315.160</td>
<td style="text-align: right;">9939.923</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">98</td>
<td style="text-align: right;">183</td>
<td style="text-align: right;">0.0064054</td>
<td style="text-align: right;">0.4829135</td>
<td style="text-align: right;">0.4483251</td>
<td style="text-align: right;">2.113142</td>
<td style="text-align: right;">64.60535</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">4_26-In-015</td>
<td style="text-align: left;">d1968_1974_ptf</td>
<td style="text-align: right;">2573553</td>
<td style="text-align: right;">1203935</td>
<td style="text-align: left;">validation</td>
<td style="text-align: left;">moderate</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6.272715</td>
<td style="text-align: right;">6.272715</td>
<td style="text-align: right;">6.718392</td>
<td style="text-align: right;">7.269008</td>
<td style="text-align: right;">1.570359</td>
<td style="text-align: right;">1.541979</td>
<td style="text-align: right;">4.130917</td>
<td style="text-align: right;">6.945287</td>
<td style="text-align: right;">1.550528</td>
<td style="text-align: right;">1.562685</td>
<td style="text-align: right;">4.000948</td>
<td style="text-align: right;">5.479310</td>
<td style="text-align: right;">0.0054557</td>
<td style="text-align: right;">0.0043268</td>
<td style="text-align: right;">0.0045225</td>
<td style="text-align: right;">0.3907509</td>
<td style="text-align: right;">4.2692256</td>
<td style="text-align: right;">0.0378648</td>
<td style="text-align: right;">0.6409346</td>
<td style="text-align: right;">0.0022611</td>
<td style="text-align: right;">-0.1020419</td>
<td style="text-align: right;">0.0161510</td>
<td style="text-align: right;">3.6032522</td>
<td style="text-align: right;">1.8169731</td>
<td style="text-align: right;">0.0346340</td>
<td style="text-align: right;">0.0476020</td>
<td style="text-align: right;">0.0378154</td>
<td style="text-align: right;">0.2968794</td>
<td style="text-align: right;">-0.0179657</td>
<td style="text-align: right;">-0.0137853</td>
<td style="text-align: right;">-0.0146946</td>
<td style="text-align: right;">0.0060875</td>
<td style="text-align: right;">1.4667766</td>
<td style="text-align: right;">0.9816071</td>
<td style="text-align: right;">0.0337645</td>
<td style="text-align: right;">-0.0000494</td>
<td style="text-align: right;">-0.3440553</td>
<td style="text-align: right;">-0.0202268</td>
<td style="text-align: right;">0.0882566</td>
<td style="text-align: right;">-0.0308456</td>
<td style="text-align: right;">0.0929077</td>
<td style="text-align: right;">2.6904552</td>
<td style="text-align: right;">1.0218329</td>
<td style="text-align: right;">-0.0008695</td>
<td style="text-align: right;">0.6999696</td>
<td style="text-align: right;">0.3944107</td>
<td style="text-align: right;">-0.8918364</td>
<td style="text-align: right;">-0.7795515</td>
<td style="text-align: right;">-0.8864348</td>
<td style="text-align: right;">-0.4249992</td>
<td style="text-align: right;">0.5919228</td>
<td style="text-align: right;">0.4304937</td>
<td style="text-align: right;">0.4614536</td>
<td style="text-align: right;">0.6559467</td>
<td style="text-align: right;">0.4574654</td>
<td style="text-align: right;">0.4330348</td>
<td style="text-align: right;">0.3299487</td>
<td style="text-align: right;">0.1889674</td>
<td style="text-align: right;">1.2301254</td>
<td style="text-align: right;">1.8937486</td>
<td style="text-align: right;">1.2098556</td>
<td style="text-align: right;">1.5986075</td>
<td style="text-align: right;">1.2745584</td>
<td style="text-align: right;">2.7759163</td>
<td style="text-align: right;">0.5375320</td>
<td style="text-align: right;">0.3582314</td>
<td style="text-align: right;">1.1426100</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.3005829</td>
<td style="text-align: right;">0.0061576</td>
<td style="text-align: right;">10.110727</td>
<td style="text-align: right;">0.5134069</td>
<td style="text-align: right;">0.0002062</td>
<td style="text-align: right;">0.000200</td>
<td style="text-align: right;">61.39244</td>
<td style="text-align: right;">1.0676192</td>
<td style="text-align: right;">-55.12566</td>
<td style="text-align: right;">-14.0670462</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0.0650000</td>
<td style="text-align: right;">0.0007469</td>
<td style="text-align: right;">5.894688</td>
<td style="text-align: right;">1315.056</td>
<td style="text-align: right;">9942.032</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">98</td>
<td style="text-align: right;">183</td>
<td style="text-align: right;">0.0042235</td>
<td style="text-align: right;">0.6290755</td>
<td style="text-align: right;">0.3974232</td>
<td style="text-align: right;">2.080674</td>
<td style="text-align: right;">61.16533</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="even">
<td style="text-align: left;">4_26-In-016</td>
<td style="text-align: left;">d1968_1974_ptf</td>
<td style="text-align: right;">2573310</td>
<td style="text-align: right;">1204328</td>
<td style="text-align: left;">calibration</td>
<td style="text-align: left;">poor</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6.272715</td>
<td style="text-align: right;">6.160700</td>
<td style="text-align: right;">5.559031</td>
<td style="text-align: right;">5.161655</td>
<td style="text-align: right;">1.569434</td>
<td style="text-align: right;">1.541606</td>
<td style="text-align: right;">2.030315</td>
<td style="text-align: right;">6.990967</td>
<td style="text-align: right;">1.563066</td>
<td style="text-align: right;">1.552568</td>
<td style="text-align: right;">4.000725</td>
<td style="text-align: right;">13.499996</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">0.0001476</td>
<td style="text-align: right;">0.0003817</td>
<td style="text-align: right;">0.1931891</td>
<td style="text-align: right;">-0.1732794</td>
<td style="text-align: right;">-0.1602274</td>
<td style="text-align: right;">0.0318570</td>
<td style="text-align: right;">-0.0035833</td>
<td style="text-align: right;">-0.1282881</td>
<td style="text-align: right;">0.0003549</td>
<td style="text-align: right;">1.5897882</td>
<td style="text-align: right;">0.8171870</td>
<td style="text-align: right;">-0.0123340</td>
<td style="text-align: right;">0.0400775</td>
<td style="text-align: right;">-0.0813964</td>
<td style="text-align: right;">0.0100844</td>
<td style="text-align: right;">-0.0049875</td>
<td style="text-align: right;">0.0320331</td>
<td style="text-align: right;">-0.0049053</td>
<td style="text-align: right;">0.0374298</td>
<td style="text-align: right;">0.7912259</td>
<td style="text-align: right;">0.3455668</td>
<td style="text-align: right;">-0.0059622</td>
<td style="text-align: right;">0.0788309</td>
<td style="text-align: right;">-0.0217726</td>
<td style="text-align: right;">-0.0014042</td>
<td style="text-align: right;">0.1603212</td>
<td style="text-align: right;">-0.0052602</td>
<td style="text-align: right;">0.0867119</td>
<td style="text-align: right;">1.0207798</td>
<td style="text-align: right;">0.6147888</td>
<td style="text-align: right;">0.0063718</td>
<td style="text-align: right;">0.3157751</td>
<td style="text-align: right;">0.5292308</td>
<td style="text-align: right;">-0.8766075</td>
<td style="text-align: right;">0.8129975</td>
<td style="text-align: right;">0.5905659</td>
<td style="text-align: right;">0.1640853</td>
<td style="text-align: right;">0.5820994</td>
<td style="text-align: right;">0.6325440</td>
<td style="text-align: right;">0.8054439</td>
<td style="text-align: right;">0.7448481</td>
<td style="text-align: right;">0.6081498</td>
<td style="text-align: right;">0.3688371</td>
<td style="text-align: right;">0.2607146</td>
<td style="text-align: right;">0.1763995</td>
<td style="text-align: right;">1.0906221</td>
<td style="text-align: right;">1.0418727</td>
<td style="text-align: right;">0.8515157</td>
<td style="text-align: right;">1.2106605</td>
<td style="text-align: right;">0.8916541</td>
<td style="text-align: right;">1.2163279</td>
<td style="text-align: right;">0.4894866</td>
<td style="text-align: right;">0.2049688</td>
<td style="text-align: right;">0.7156029</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">-0.0910767</td>
<td style="text-align: right;">0.0034276</td>
<td style="text-align: right;">9.574804</td>
<td style="text-align: right;">0.3864355</td>
<td style="text-align: right;">0.0001151</td>
<td style="text-align: right;">0.000525</td>
<td style="text-align: right;">310.05014</td>
<td style="text-align: right;">0.1321367</td>
<td style="text-align: right;">-17.16055</td>
<td style="text-align: right;">-28.0693741</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0.0731646</td>
<td style="text-align: right;">0.0128017</td>
<td style="text-align: right;">5.938320</td>
<td style="text-align: right;">1315.000</td>
<td style="text-align: right;">9940.597</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">98</td>
<td style="text-align: right;">183</td>
<td style="text-align: right;">0.0040683</td>
<td style="text-align: right;">0.6997021</td>
<td style="text-align: right;">0.4278295</td>
<td style="text-align: right;">2.041467</td>
<td style="text-align: right;">55.78354</td>
<td style="text-align: right;">6</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="more-data-wrangling" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="more-data-wrangling"><span class="header-section-number">2.4</span> More data wrangling</h2>
<p>Now, not all our covariates may be continuous variables and therefore have to be encoded as factors. As an easy check, we can take the original corvariates data and check for the number of unique values in each raster. If the variable is continuous, we expect that there are a lot of different values - at maximum 1052 different values because we have that many entries. So, let’s have a look and assume that variables with 10 or less different values are categorical variables.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>vars_categorical <span class="ot">&lt;-</span> df_covars <span class="sc">|&gt;</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get number of distinct values per variable</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(dplyr<span class="sc">::</span><span class="fu">across</span>(dplyr<span class="sc">::</span><span class="fu">everything</span>(), <span class="sc">~</span>dplyr<span class="sc">::</span><span class="fu">n_distinct</span>(.))) <span class="sc">|&gt;</span> </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Turn df into long format for easy filtering</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">everything</span>(), </span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"variable"</span>, </span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"n"</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter out variables with 10 or less distinct values</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(n <span class="sc">&lt;=</span> <span class="dv">10</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract the names of these variables</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(<span class="st">'variable'</span>)</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Variables with less than 10 distinct values:"</span>, </span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ifelse</span>(<span class="fu">length</span>(vars_categorical) <span class="sc">==</span> <span class="dv">0</span>, <span class="st">"none"</span>, vars_categorical))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Variables with less than 10 distinct values: geo500h1id</code></pre>
</div>
</div>
<p>Now that we have the names of the categorical values, we can mutate these columns in our data frame using the base function <code>as.factor()</code>:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>df_full <span class="ot">&lt;-</span> df_full <span class="sc">|&gt;</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(dplyr<span class="sc">::</span><span class="fu">across</span>(<span class="fu">all_of</span>(vars_categorical), <span class="sc">~</span><span class="fu">as.factor</span>(.)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="checking-missing-data" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="checking-missing-data"><span class="header-section-number">2.5</span> Checking missing data</h2>
<p>We are almost done with our data preparation, we just need to reduce it to sampling locations for which we have a decent amount of data on the covariates. Else, we blow up the model calibration with data that is not informative enough.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get number of rows to calculate percentages</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>n_rows <span class="ot">&lt;-</span> <span class="fu">nrow</span>(df_full)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get number of distinct values per variable</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>df_full <span class="sc">|&gt;</span> </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(dplyr<span class="sc">::</span><span class="fu">across</span>(dplyr<span class="sc">::</span><span class="fu">everything</span>(), </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>                                 <span class="sc">~</span> <span class="fu">length</span>(.) <span class="sc">-</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(.)))) <span class="sc">|&gt;</span> </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(dplyr<span class="sc">::</span><span class="fu">everything</span>(), </span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">names_to =</span> <span class="st">"variable"</span>, </span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">values_to =</span> <span class="st">"n"</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">perc_available =</span> <span class="fu">round</span>(n <span class="sc">/</span> n_rows <span class="sc">*</span> <span class="dv">100</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(perc_available) <span class="sc">|&gt;</span> </span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: right;">n</th>
<th style="text-align: right;">perc_available</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ph.30.50</td>
<td style="text-align: right;">856</td>
<td style="text-align: right;">81</td>
</tr>
<tr class="even">
<td style="text-align: left;">ph.10.30</td>
<td style="text-align: right;">866</td>
<td style="text-align: right;">82</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ph.50.100</td>
<td style="text-align: right;">859</td>
<td style="text-align: right;">82</td>
</tr>
<tr class="even">
<td style="text-align: left;">timeset</td>
<td style="text-align: right;">871</td>
<td style="text-align: right;">83</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ph.0.10</td>
<td style="text-align: right;">870</td>
<td style="text-align: right;">83</td>
</tr>
<tr class="even">
<td style="text-align: left;">dclass</td>
<td style="text-align: right;">1006</td>
<td style="text-align: right;">96</td>
</tr>
<tr class="odd">
<td style="text-align: left;">site_id_unique</td>
<td style="text-align: right;">1052</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">x</td>
<td style="text-align: right;">1052</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">y</td>
<td style="text-align: right;">1052</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">dataset</td>
<td style="text-align: right;">1052</td>
<td style="text-align: right;">100</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This looks good, we have no variable with a substantial amount of missing data. Generally, only pH measurements are lacking, which we should keep in mind when making predictions and inferences. Another great way to explore your data, is using the {visdat} package:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>df_full <span class="sc">|&gt;</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>) <span class="sc">|&gt;</span>   <span class="co"># reduce data for readability of the plot</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  visdat<span class="sc">::</span><span class="fu">vis_miss</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="02-data_preparation_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Alright, we see that we are not missing any data in the covariate data. Mostly sampled data, specifically pH and timeset data is missing. We also see that this missing data is mostly from the same entries, so if we keep only entries where we have pH data - which is what we are interested in here - we have a dataset with pracitally no missing data.</p>
</section>
<section id="save-data" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="save-data"><span class="header-section-number">2.6</span> Save data</h2>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>))) <span class="fu">system</span>(<span class="fu">paste0</span>(<span class="st">"mkdir "</span>, here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>)))</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(df_full, </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>        here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data/df_full.rds"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./01-introduction.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./03-model_training.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Train a Random Forest</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>